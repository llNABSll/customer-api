{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:27:33+0000", "level": "ERROR", "logger": "app.core.database", "msg": "db session rolled back due to exception", "service": "customer-api", "request_id": "594d67978a45437f82131492e1f226a9", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/core/database.py\", line 54, in get_db\n    yield db\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/concurrency.py\", line 27, in contextmanager_in_threadpool\n    yield await run_in_threadpool(cm.__enter__)\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 215, in run_endpoint_function\n    return await run_in_threadpool(dependant.call, **values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2476, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 967, in run\n    result = context.run(func, *args)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/api/routes.py\", line 68, in list_customers\n    rows = svc.list(\n           ^^^^^^^^^\nTypeError: CustomerService.list() got an unexpected keyword argument 'q'"}
{"ts": "2025-09-08T21:27:33+0000", "level": "ERROR", "logger": "uvicorn.error", "msg": "Exception in ASGI application\n", "service": "customer-api", "request_id": "-", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 183, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 772, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 409, in run_asgi\n    |     result = await app(  # type: ignore[func-returns-value]\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    |     return await self.app(scope, receive, send)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/applications.py\", line 113, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |   File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/app/app/main.py\", line 96, in metrics_middleware\n    |     response: Response = await call_next(request)\n    |                          ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    |     raise app_exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |   File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/app/app/core/logging.py\", line 164, in access_log_middleware\n    |     response: Response = await call_next(request)\n    |                          ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    |     raise app_exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 78, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 75, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 302, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 215, in run_endpoint_function\n    |     return await run_in_threadpool(dependant.call, **values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2476, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 967, in run\n    |     result = context.run(func, *args)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/app/app/api/routes.py\", line 68, in list_customers\n    |     rows = svc.list(\n    |            ^^^^^^^^^\n    | TypeError: CustomerService.list() got an unexpected keyword argument 'q'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 409, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/applications.py\", line 113, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/main.py\", line 96, in metrics_middleware\n    response: Response = await call_next(request)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/core/logging.py\", line 164, in access_log_middleware\n    response: Response = await call_next(request)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 215, in run_endpoint_function\n    return await run_in_threadpool(dependant.call, **values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2476, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 967, in run\n    result = context.run(func, *args)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/api/routes.py\", line 68, in list_customers\n    rows = svc.list(\n           ^^^^^^^^^\nTypeError: CustomerService.list() got an unexpected keyword argument 'q'"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:07+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:39:24+0000", "level": "ERROR", "logger": "app.core.database", "msg": "db session rolled back due to exception", "service": "customer-api", "request_id": "eec751eb8bf64ca398ee7dfd427b7084", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 951, in do_execute\n    cursor.execute(statement, parameters)\npsycopg2.errors.UndefinedColumn: column clients.created_at does not exist\nLINE 1: ... clients_company, clients.phone AS clients_phone, clients.cr...\n                                                             ^\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/core/database.py\", line 54, in get_db\n    yield db\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/concurrency.py\", line 27, in contextmanager_in_threadpool\n    yield await run_in_threadpool(cm.__enter__)\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 215, in run_endpoint_function\n    return await run_in_threadpool(dependant.call, **values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2476, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 967, in run\n    result = context.run(func, *args)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/api/routes.py\", line 69, in list_customers\n    rows = svc.list(\n           ^^^^^^^^^\n  File \"/app/app/services/client_service.py\", line 77, in list\n    return query.offset(skip).limit(limit).all()\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2704, in all\n    return self._iter().all()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2857, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2365, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2251, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 306, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1419, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 526, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1641, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 951, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column clients.created_at does not exist\nLINE 1: ... clients_company, clients.phone AS clients_phone, clients.cr...\n                                                             ^\n\n[SQL: SELECT clients.id AS clients_id, clients.name AS clients_name, clients.email AS clients_email, clients.company AS clients_company, clients.phone AS clients_phone, clients.created_at AS clients_created_at, clients.updated_at AS clients_updated_at, clients.version AS clients_version \nFROM clients ORDER BY clients.id \n LIMIT %(param_1)s OFFSET %(param_2)s]\n[parameters: {'param_1': 10, 'param_2': 0}]\n(Background on this error at: https://sqlalche.me/e/20/f405)"}
{"ts": "2025-09-08T21:39:24+0000", "level": "ERROR", "logger": "uvicorn.error", "msg": "Exception in ASGI application\n", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 951, in do_execute\n    cursor.execute(statement, parameters)\npsycopg2.errors.UndefinedColumn: column clients.created_at does not exist\nLINE 1: ... clients_company, clients.phone AS clients_phone, clients.cr...\n                                                             ^\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 409, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/applications.py\", line 113, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/main.py\", line 96, in metrics_middleware\n    response: Response = await call_next(request)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/core/logging.py\", line 164, in access_log_middleware\n    response: Response = await call_next(request)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 215, in run_endpoint_function\n    return await run_in_threadpool(dependant.call, **values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2476, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 967, in run\n    result = context.run(func, *args)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/api/routes.py\", line 69, in list_customers\n    rows = svc.list(\n           ^^^^^^^^^\n  File \"/app/app/services/client_service.py\", line 77, in list\n    return query.offset(skip).limit(limit).all()\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2704, in all\n    return self._iter().all()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2857, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2365, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2251, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 306, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1419, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 526, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1641, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 951, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column clients.created_at does not exist\nLINE 1: ... clients_company, clients.phone AS clients_phone, clients.cr...\n                                                             ^\n\n[SQL: SELECT clients.id AS clients_id, clients.name AS clients_name, clients.email AS clients_email, clients.company AS clients_company, clients.phone AS clients_phone, clients.created_at AS clients_created_at, clients.updated_at AS clients_updated_at, clients.version AS clients_version \nFROM clients ORDER BY clients.id \n LIMIT %(param_1)s OFFSET %(param_2)s]\n[parameters: {'param_1': 10, 'param_2': 0}]\n(Background on this error at: https://sqlalche.me/e/20/f405)"}
{"ts": "2025-09-08T21:43:38+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "edf50211a5e24c3ba8b5418c63d8d56d"}
{"ts": "2025-09-08T21:43:38+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk='%s' payload=%s", "service": "customer-api", "request_id": "edf50211a5e24c3ba8b5418c63d8d56d"}
{"ts": "2025-09-08T21:43:38+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "edf50211a5e24c3ba8b5418c63d8d56d"}
{"ts": "2025-09-08T21:43:38+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "edf50211a5e24c3ba8b5418c63d8d56d"}
{"ts": "2025-09-08T21:45:10+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:47:00+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:38+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:53:43+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a348a4ba5c1a4a888fbe6b3f2945f065"}
{"ts": "2025-09-08T21:53:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk='%s' payload=%s", "service": "customer-api", "request_id": "a348a4ba5c1a4a888fbe6b3f2945f065"}
{"ts": "2025-09-08T21:53:43+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a348a4ba5c1a4a888fbe6b3f2945f065"}
{"ts": "2025-09-08T21:53:43+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a348a4ba5c1a4a888fbe6b3f2945f065"}
{"ts": "2025-09-08T21:58:51+0000", "level": "ERROR", "logger": "aiormq.connection", "msg": "Unexpected connection close from remote \"%s\", Connection.Close(reply_code=%r, reply_text=%r)", "service": "customer-api", "request_id": "-", "exc_info": "NoneType: None"}
{"ts": "2025-09-08T21:58:51+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to %s closed. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:58:51+0000", "level": "ERROR", "logger": "aio_pika.tools", "msg": "Callback %r error", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/tools.py\", line 306, in __task_inner\n    await self.callback(*args, **kwargs)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 119, in _on_close\n    await self.restore()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 94, in restore\n    await self.reopen()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 132, in reopen\n    await super().reopen()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/channel.py\", line 244, in reopen\n    await self._open()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/channel.py\", line 173, in _open\n    channel = await UnderlayChannel.create(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/abc.py\", line 485, in create\n    channel = await connection.channel(**kwargs)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 918, in channel\n    raise RuntimeError(\"%r closed\" % self)\nRuntimeError: <Connection: \"amqp://app:******@rabbitmq:5672/%2F\" at 0x7f5584f1eb20> closed"}
{"ts": "2025-09-08T21:58:51+0000", "level": "ERROR", "logger": "aio_pika.tools", "msg": "Callback %r error", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/tools.py\", line 306, in __task_inner\n    await self.callback(*args, **kwargs)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 119, in _on_close\n    await self.restore()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 94, in restore\n    await self.reopen()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 132, in reopen\n    await super().reopen()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/channel.py\", line 244, in reopen\n    await self._open()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/channel.py\", line 169, in _open\n    raise ChannelInvalidStateError(\"No active transport in channel\")\naiormq.exceptions.ChannelInvalidStateError: No active transport in channel"}
{"ts": "2025-09-08T21:58:51+0000", "level": "ERROR", "logger": "aiormq.connection", "msg": "error when creating transport: %r", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:58:51+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to %s closed. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:58:51+0000", "level": "WARNING", "logger": "aio_pika.robust_connection", "msg": "Connection attempt to \"%s\" failed: %s. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:04+0000", "level": "ERROR", "logger": "aiormq.connection", "msg": "error when creating transport: %r", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:04+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to %s closed. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:04+0000", "level": "WARNING", "logger": "aio_pika.robust_connection", "msg": "Connection attempt to \"%s\" failed: %s. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:08+0000", "level": "ERROR", "logger": "aiormq.connection", "msg": "error when creating transport: %r", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:08+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to %s closed. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:08+0000", "level": "WARNING", "logger": "aio_pika.robust_connection", "msg": "Connection attempt to \"%s\" failed: %s. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:13+0000", "level": "ERROR", "logger": "aiormq.connection", "msg": "error when creating transport: %r", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:13+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to %s closed. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:13+0000", "level": "WARNING", "logger": "aio_pika.robust_connection", "msg": "Connection attempt to \"%s\" failed: %s. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:17+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:17+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:17+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:17+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:17+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:53+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "46df3276027347099b633b1150364f72"}
{"ts": "2025-09-08T22:00:53+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk='%s' payload=%s", "service": "customer-api", "request_id": "46df3276027347099b633b1150364f72"}
{"ts": "2025-09-08T22:00:53+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "46df3276027347099b633b1150364f72"}
{"ts": "2025-09-08T22:00:53+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "46df3276027347099b633b1150364f72"}
{"ts": "2025-09-08T22:03:01+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:05:59+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6549b4c0460f402ca37d2b9813ab250d"}
{"ts": "2025-09-08T22:05:59+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk='%s' payload=%s", "service": "customer-api", "request_id": "6549b4c0460f402ca37d2b9813ab250d"}
{"ts": "2025-09-08T22:05:59+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6549b4c0460f402ca37d2b9813ab250d"}
{"ts": "2025-09-08T22:05:59+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6549b4c0460f402ca37d2b9813ab250d"}
{"ts": "2025-09-08T22:06:10+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:07:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a506900b2b25431390bad75c3228b489"}
{"ts": "2025-09-08T22:07:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk='%s' payload=%s", "service": "customer-api", "request_id": "a506900b2b25431390bad75c3228b489"}
{"ts": "2025-09-08T22:07:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a506900b2b25431390bad75c3228b489"}
{"ts": "2025-09-08T22:07:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a506900b2b25431390bad75c3228b489"}
{"ts": "2025-09-08T22:07:41+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to amqp://guest:******@rabbitmq:5672/%2F closed. Reconnecting after 5 seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "ERROR", "logger": "customer-api", "msg": "RabbitMQ startup failed", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/abc.py\", line 44, in __inner\n    return await self.task\n           ^^^^^^^^^^^^^^^\nasyncio.exceptions.CancelledError\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/main.py\", line 51, in lifespan\n    await rabbitmq.connect()\n  File \"/app/app/infra/events/rabbitmq.py\", line 40, in connect\n    self.connection = await aio_pika.connect_robust(self.url)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 340, in connect_robust\n    await connection.connect(timeout=timeout)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 186, in connect\n    await self.__fail_fast_future\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 141, in __connection_factory\n    await Connection.connect(self, self.__connect_timeout)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/connection.py\", line 118, in connect\n    self.transport = await UnderlayConnection.connect(\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/abc.py\", line 671, in connect\n    connection = await cls.make_connection(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/abc.py\", line 659, in make_connection\n    connection: aiormq.abc.AbstractConnection = await asyncio.wait_for(\n                                                ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/asyncio/tasks.py\", line 452, in wait_for\n    return await fut\n           ^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 920, in connect\n    await connection.connect(client_properties or {})\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/base.py\", line 164, in wrap\n    return await self.create_task(func(self, *args, **kwargs))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/abc.py\", line 46, in __inner\n    raise self._exception from e\n  File \"/usr/local/lib/python3.11/asyncio/tasks.py\", line 694, in _wrap_awaitable\n    return (yield from awaitable.__await__())\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/abc.py\", line 46, in __inner\n    raise self._exception from e\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 484, in connect\n    frame = await self._rpc(\n            ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 436, in _rpc\n    raise ProbableAuthenticationError(frame.reply_text)\naiormq.exceptions.ProbableAuthenticationError: ACCESS_REFUSED - Login was refused using authentication mechanism PLAIN. For details see the broker logfile."}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:37:18+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:37:19+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:37:19+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:37:19+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:27+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:27+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:27+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:28+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:28+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:32+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "09f50e3dd16f4214a5f6cc0a509a5f28", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T10:38:33+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "b42b7eb964e4412dbf91e513e470077d", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T10:38:34+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "7baa580c8d73444a9b821f2a0a24cb6e", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T10:38:34+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "29ab6f85f9cf4a5b971018262f652e01", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T10:38:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f40ed650fa244510bd6dbc21b80c9672"}
{"ts": "2025-09-09T10:38:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "03d5012d561140ca9dba8109cae21fa3"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to amqp://app:******@rabbitmq:5672/%2F closed. Reconnecting after 5 seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.9b1dc38c2b3f46d8aa6bc5845939bb55'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:10+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "8dbe1e1f308a4bed8c21b9e800581c53", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:32:11+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "d5c11f65601b457eb655dadf3982526e", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:32:12+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "19c8eb37df08454c937fc3332308123d", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:32:13+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "b384df4511bd482f8e1c461710a996b1", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:32:14+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e6e2e8c47c3d4b7c9e62e1ad38e634b0"}
{"ts": "2025-09-09T11:32:14+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:14+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:14+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:14+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "8da7bbd34ce149e18488f2f9a1c4c41f"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.8f7bc4eec1c448edb45105ff2d37c0d0'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:36+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "8fc76747a412477e9e480353be011c97", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:39:37+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "851d1bda503e4bd18bbc7d71e952fde1", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:39:38+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "9d82b94a81924d98929ba02ce87b46e6", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:39:39+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "f71c87e1644147aca3fddbc6e629aa30", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T11:39:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.83f32c2181f24530ad57a5ac15c1b0e4'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:52:59+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "4d7efc6b7bde46fa997669e3c736ff70", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:53:00+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "01a8c6306ebf482b9752310718f7aeb1", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:53:01+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "10360d7999424e8aa074ff69c7c9a47e", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:53:02+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "09b6c9bedf5e40d1933eb267de3dae6d", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9c649913450f4d3387e2767130618e41"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "fbaffdbd14de4da293ce906a7d577aef"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "3bfb437b3b234e19a8de6a45417279be"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.ae883b6f3cf346fcbbf5c588960e7961'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:40+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "bf34e21f96764bddb038a333ac3bba67", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:56:42+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "b037e695da754691b628498b39077dcc", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:56:42+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "c160029c9ac045a7abd3461386c62f08", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:56:43+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "6633bb1bd8df4d7eaac19c663125a208", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:56:44+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b8dd456189fc4cd3aa1cfc4dabf9ed1f"}
{"ts": "2025-09-09T11:56:44+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:44+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:44+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "c0222e34960e43dea0b931b1f6fd10eb"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f565fb578f8b47eb8615f5f68076cca2"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.4837e35f07e243e2aa50dc8724bb56c0'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:17+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "2312c773aee84dbaacf87389170beb54", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T12:08:18+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "6982cbef5ae94f358ea563c5ca4446df", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T12:08:19+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "24644c1c4923433fa0fe316bb2c51dc7", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T12:08:21+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "505549568340420ab9ea97bfd13a8347", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "57b3412e22b4436aa4f8ac2f55dc0753"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "2453f8d070a4478c86682c32808962ed"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "eddfa9f5c7a842be9007844ca8574ba2"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:24+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:24+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:25+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:25+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:25+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.7b79182181144e3c9510b92e78bc0de5'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "55018b344ddc4e3eafa16a199c49716c"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "55018b344ddc4e3eafa16a199c49716c"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "55018b344ddc4e3eafa16a199c49716c"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "99c66eb64f1d4cbaab071b4a112b6370"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "99c66eb64f1d4cbaab071b4a112b6370"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "99c66eb64f1d4cbaab071b4a112b6370"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "7c040c3ffa894b90a2a29b867bd232f7", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "c67efb87a853497a8b2736392b5af894"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "c67efb87a853497a8b2736392b5af894"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "c67efb87a853497a8b2736392b5af894"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ef97a0acde6e49d6821467ae56e820c6"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ef97a0acde6e49d6821467ae56e820c6"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ef97a0acde6e49d6821467ae56e820c6"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "02488c402ae1473d81d4715319fec87c"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "02488c402ae1473d81d4715319fec87c"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "02488c402ae1473d81d4715319fec87c"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "24c9d7573aa4485b9113e2962c018e68"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "24c9d7573aa4485b9113e2962c018e68"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "24c9d7573aa4485b9113e2962c018e68"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "8753d9f9071b4ac1a7ab0af3e88b0270"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "8753d9f9071b4ac1a7ab0af3e88b0270"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "8753d9f9071b4ac1a7ab0af3e88b0270"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ab6ea3aab3a74e898971ba04868fe0ca"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "085043d233dd4e8d9aa430dca8db6564"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "dc1bd1e4b2384fd0a52920f81031e8b8"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.52ca604f7d9741358861eb93175390ba'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ce2b7c07fc6f4851aafc226f6fdd8c5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ce2b7c07fc6f4851aafc226f6fdd8c5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ce2b7c07fc6f4851aafc226f6fdd8c5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e5be47a1db36464487fffcb054f71cac"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e5be47a1db36464487fffcb054f71cac"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e5be47a1db36464487fffcb054f71cac"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "4a253ef40a234ad1adaa665d73c78d6d", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "be048c6d0d22413196579ece9059f0b1"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "be048c6d0d22413196579ece9059f0b1"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "be048c6d0d22413196579ece9059f0b1"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e7b1d1d5009e4b2f983ab0de10a1181f"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e7b1d1d5009e4b2f983ab0de10a1181f"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e7b1d1d5009e4b2f983ab0de10a1181f"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "67c228d2551b45aeaf9b0eda4fd0c6a7"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "67c228d2551b45aeaf9b0eda4fd0c6a7"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "67c228d2551b45aeaf9b0eda4fd0c6a7"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "f5fa8f2568dc443699ec4b489de20e5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "f5fa8f2568dc443699ec4b489de20e5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "f5fa8f2568dc443699ec4b489de20e5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "d32d14c98c4f4e2cafc318decca4d2b6"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "d32d14c98c4f4e2cafc318decca4d2b6"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "d32d14c98c4f4e2cafc318decca4d2b6"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "1d376cfb32e04f63818ce16b2a5a7b97"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "3d38b4561be14cf39c9115fe065aeb7f"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "562bae25ea12467588ded5a6dc2daeb0"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:06+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "fd53f06477dd45bea2c63b43a2713bd7"}
{"ts": "2025-09-09T14:33:06+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "fd53f06477dd45bea2c63b43a2713bd7"}
{"ts": "2025-09-09T14:33:06+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fd53f06477dd45bea2c63b43a2713bd7"}
{"ts": "2025-09-09T14:33:06+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:06+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0f372bf2c17f4cf2874b79205b13b05c"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0f372bf2c17f4cf2874b79205b13b05c"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0f372bf2c17f4cf2874b79205b13b05c"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "2a7ff6297db64bffbc5237ed2f90b638", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "eea7deabcae94a4a879e30d27fd400d3"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "eea7deabcae94a4a879e30d27fd400d3"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "eea7deabcae94a4a879e30d27fd400d3"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "707a1e9887e64118b86ef63db5897652"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "707a1e9887e64118b86ef63db5897652"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "707a1e9887e64118b86ef63db5897652"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "dfdf92778b91460889ff9632fb2f325d"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "dfdf92778b91460889ff9632fb2f325d"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "dfdf92778b91460889ff9632fb2f325d"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "ac07a39d99f344ee84c940e642b09772"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "ac07a39d99f344ee84c940e642b09772"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "ac07a39d99f344ee84c940e642b09772"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "0a19f8a6fc1f43c397f622bae77cb858"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "0a19f8a6fc1f43c397f622bae77cb858"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "0a19f8a6fc1f43c397f622bae77cb858"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "eaf7cb903f1140959380b3d6ccf1ffa0"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "db33e54c657c4b21b3e4a9449de87771"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "a3d74f5c551043078d3e011ada6cd8a6"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0b4de911ce9940d99d8edf878c11b112"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0b4de911ce9940d99d8edf878c11b112"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0b4de911ce9940d99d8edf878c11b112"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a7a1dca10eef4e52a88452289dc75edd"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a7a1dca10eef4e52a88452289dc75edd"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a7a1dca10eef4e52a88452289dc75edd"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "431608b4851c4ab7881e703430b0fec4", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "2da32e542f9648d2b8f9fa0a80f81566"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "2da32e542f9648d2b8f9fa0a80f81566"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2da32e542f9648d2b8f9fa0a80f81566"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6270469eb82c4e2b87a178b92e26b4bf"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6270469eb82c4e2b87a178b92e26b4bf"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6270469eb82c4e2b87a178b92e26b4bf"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f8b4869a85d94542867a8a7bc2fc8c64"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f8b4869a85d94542867a8a7bc2fc8c64"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f8b4869a85d94542867a8a7bc2fc8c64"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "50d8b62b0be84e22913d1f3de2c16be4"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "50d8b62b0be84e22913d1f3de2c16be4"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "50d8b62b0be84e22913d1f3de2c16be4"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "f4972da9a71d432d9f15403c82b58efc"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "f4972da9a71d432d9f15403c82b58efc"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f4972da9a71d432d9f15403c82b58efc"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e263aaad5bba4955b708281c5b48cb15"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "f835fe4788e94f43af2f92866812fa73"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "0fddfecd47354cc18b71ef06b7199c99"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "8c1413a1d7094080bc2c75d80ca7bb48"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "8c1413a1d7094080bc2c75d80ca7bb48"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8c1413a1d7094080bc2c75d80ca7bb48"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0f68215af9824fd2a1174f73d5403525"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0f68215af9824fd2a1174f73d5403525"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0f68215af9824fd2a1174f73d5403525"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "0ea09f9bcc1f4f96ba0f876c02bab429", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "524440ebbb92434f95cd11e78a2a8ba9"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "524440ebbb92434f95cd11e78a2a8ba9"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "524440ebbb92434f95cd11e78a2a8ba9"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "33173d68eada4e2087174b6d9b006cc8"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "33173d68eada4e2087174b6d9b006cc8"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "33173d68eada4e2087174b6d9b006cc8"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9d1b48266598496ea6d0e308e98952a2"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9d1b48266598496ea6d0e308e98952a2"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9d1b48266598496ea6d0e308e98952a2"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/4 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "3e587014b3424c169e2d311075896e02"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "3e587014b3424c169e2d311075896e02"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "3e587014b3424c169e2d311075896e02"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/4 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/4 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "6b4218e3b09f49bda31a890ec5f1850c"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "6b4218e3b09f49bda31a890ec5f1850c"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "6b4218e3b09f49bda31a890ec5f1850c"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/4 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/4 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2feb789478f7412285f713a9c3b040a4"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "c6377b95af2d4791bf79d4a94910e3a1"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "3fa627c6c0be4e32b0fa461373667ad2"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "53425f55e9ff478f8c611febfd373522"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "53425f55e9ff478f8c611febfd373522"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "53425f55e9ff478f8c611febfd373522"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "607e594fd2ce4518b48fa66029142a83"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "607e594fd2ce4518b48fa66029142a83"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "607e594fd2ce4518b48fa66029142a83"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "7bb1cc4ce1364b4a9582896abaf20454", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9912b780bdaa486e80f61627e23053dd"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9912b780bdaa486e80f61627e23053dd"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9912b780bdaa486e80f61627e23053dd"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "4bfbf6c252734f59959bb9aad85e8492"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "4bfbf6c252734f59959bb9aad85e8492"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "4bfbf6c252734f59959bb9aad85e8492"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "bd607fa4531e43a080468fd6d4d07880"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "bd607fa4531e43a080468fd6d4d07880"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bd607fa4531e43a080468fd6d4d07880"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "a3bd8cfa7f4d49d8b047cc572f0fdebb"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "a3bd8cfa7f4d49d8b047cc572f0fdebb"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "a3bd8cfa7f4d49d8b047cc572f0fdebb"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "ba08b607b0fd4d80a26323f0daf4dcf4"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "ba08b607b0fd4d80a26323f0daf4dcf4"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "ba08b607b0fd4d80a26323f0daf4dcf4"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a14d1908842d4b6cb7394cb31467e2e1"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "f8c1f6f13fb54d09b72d2f40bf632deb"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "95694ec167fc4f2985efb2a661f40fa3"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:44+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "7c598abdcd164586bc8029ebc63ba9e9", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T14:34:45+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "0979ed3473e14459910171519f39059e", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T14:34:46+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "a2de91a1a93940048a1f081abc2df8e1", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T14:34:48+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "7ab1c0dae14a4fe799156914ac633744", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e708b7c910a34e75bdf80c5a5e769c95"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "6ab9753a8b03468abbb11eade5f3eec7"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "2c2b98cc06fa49e9bd9ea1d1c6b9e174"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "86866327a4e04e6aa8ec57986226f258"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "86866327a4e04e6aa8ec57986226f258"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "86866327a4e04e6aa8ec57986226f258"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6fdfb95914c94cfe8df099c2f6254076"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6fdfb95914c94cfe8df099c2f6254076"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6fdfb95914c94cfe8df099c2f6254076"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "f28f10c102ce4beba2d381a68a02598d", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f21631340904487f86a5b240454ec15a"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f21631340904487f86a5b240454ec15a"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f21631340904487f86a5b240454ec15a"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "bced5fa9211e4c1db17a55c4f500e167"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "bced5fa9211e4c1db17a55c4f500e167"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bced5fa9211e4c1db17a55c4f500e167"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "bc8e63982f5e48c3877e334e5a77082d"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "bc8e63982f5e48c3877e334e5a77082d"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bc8e63982f5e48c3877e334e5a77082d"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "7d6e1b5757784808b6ad0925cc3454f9"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "7d6e1b5757784808b6ad0925cc3454f9"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "7d6e1b5757784808b6ad0925cc3454f9"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "66547dd8071c4f0cbf828c34b04791d2"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "66547dd8071c4f0cbf828c34b04791d2"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "66547dd8071c4f0cbf828c34b04791d2"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "dbf0af0ec3434e1981146129e2234cdf"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "e3a3d9168b02465aaaed409d6730d756"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "4f69334f41e5426289d0fe866343fcfe"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.3d228febfb1f4203bd112519dca5e11f'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "82430e2ba69b462396b27a03ec0b63ab"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "82430e2ba69b462396b27a03ec0b63ab"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "82430e2ba69b462396b27a03ec0b63ab"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "58f530aca36c4d3082b0c1c833caa52e"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "58f530aca36c4d3082b0c1c833caa52e"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "58f530aca36c4d3082b0c1c833caa52e"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "9bf34b0e3b6647879f8da9e04148c3e6", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "76cf519d4938458c8df813702e02ea07"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "76cf519d4938458c8df813702e02ea07"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "76cf519d4938458c8df813702e02ea07"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6f2430fad750443095b7fa757136dba4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6f2430fad750443095b7fa757136dba4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6f2430fad750443095b7fa757136dba4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "1f383b0ee64542adb403dc51f024bfdf"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "1f383b0ee64542adb403dc51f024bfdf"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "1f383b0ee64542adb403dc51f024bfdf"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "6d0ca92a86e148fcbcf3833bf105b5b4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "6d0ca92a86e148fcbcf3833bf105b5b4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "6d0ca92a86e148fcbcf3833bf105b5b4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "aa6fdaeca2b24d5d87f0d1abd72c39cb"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "aa6fdaeca2b24d5d87f0d1abd72c39cb"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "aa6fdaeca2b24d5d87f0d1abd72c39cb"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b7c2e556a68a4abe87dcb59f4bdee387"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "c81f53fc571f41c4bf9de94e9acd9ee5"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "31f9509a45bd4e32b955f687b16c28dd"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.58cbf6b4eebe430fa8781426b18843c0'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e245c9cc8ca342a9960cd24d7a904bd8"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e245c9cc8ca342a9960cd24d7a904bd8"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e245c9cc8ca342a9960cd24d7a904bd8"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "b4e84579668746f5b0191a954490721e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "b4e84579668746f5b0191a954490721e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b4e84579668746f5b0191a954490721e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "57f5a6b85e0740288cd8fae3b5e35bd5", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "cd582e51b907496a96271fc48556e2c2"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "cd582e51b907496a96271fc48556e2c2"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "cd582e51b907496a96271fc48556e2c2"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "c8309b7a7de14775a55b6dfb7144d991"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "c8309b7a7de14775a55b6dfb7144d991"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "c8309b7a7de14775a55b6dfb7144d991"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "da751d16bd9a4a879a7ab9dc94ff5655"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "da751d16bd9a4a879a7ab9dc94ff5655"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "da751d16bd9a4a879a7ab9dc94ff5655"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "2b3e51c427c844d28f0ff61033b4722e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "2b3e51c427c844d28f0ff61033b4722e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "2b3e51c427c844d28f0ff61033b4722e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "80a0bba9b4c94219a5b9affde51761c5"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "80a0bba9b4c94219a5b9affde51761c5"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "80a0bba9b4c94219a5b9affde51761c5"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2834f437b78b4f168bd7415b4e68554f"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "43aeb7d326bd469390a9d026cace8692"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "66691c2cca7e4df68a78d1516a099d09"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:59:07+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:59:07+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:59:07+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:59:07+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:59:07+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "174691e3e7cf4435b5423bdd38e84b56"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "174691e3e7cf4435b5423bdd38e84b56"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "174691e3e7cf4435b5423bdd38e84b56"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9b635dc87c61445cbcd6e5180e72e0c9"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9b635dc87c61445cbcd6e5180e72e0c9"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9b635dc87c61445cbcd6e5180e72e0c9"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "3562af1ae3674de89556ed41e3438d70", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "88848cb6c11c4eb88e757667c0f9c490"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "88848cb6c11c4eb88e757667c0f9c490"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "88848cb6c11c4eb88e757667c0f9c490"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "4aee787a23b44d9bbce342b66a00f332"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "4aee787a23b44d9bbce342b66a00f332"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "4aee787a23b44d9bbce342b66a00f332"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "97926759c3494147a978305a6bfbc3b1"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "97926759c3494147a978305a6bfbc3b1"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "97926759c3494147a978305a6bfbc3b1"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "b68ee6d34a3f44ee9a60e70e8e01438a"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "b68ee6d34a3f44ee9a60e70e8e01438a"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "b68ee6d34a3f44ee9a60e70e8e01438a"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "93ccfc274dc94f18b1f10e45ceb4bcff"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "93ccfc274dc94f18b1f10e45ceb4bcff"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "93ccfc274dc94f18b1f10e45ceb4bcff"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bed9e8a0564c466697d47f16440be240"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "dc07af4646384890b784f9c0a778c306"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "6720322c72f34cbf9b9eb66ea1f653e7"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.a50f064614694682b48ecbd20af8a7f1'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "7a831195c8e54dc2974c2bc544090f00"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "7a831195c8e54dc2974c2bc544090f00"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "7a831195c8e54dc2974c2bc544090f00"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "66c221d0327d49b795cd7146bbcc3d5b"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "66c221d0327d49b795cd7146bbcc3d5b"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "66c221d0327d49b795cd7146bbcc3d5b"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:12+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "f6ba77cc406649f0b0a5ccd3174a5648", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "cb1808bf62aa43c899a3371b1115a717"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "cb1808bf62aa43c899a3371b1115a717"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "cb1808bf62aa43c899a3371b1115a717"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a520cc72e5b3421db9bdd347b5d6db6e"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a520cc72e5b3421db9bdd347b5d6db6e"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a520cc72e5b3421db9bdd347b5d6db6e"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0c4ee7ffde1046f8b64d33b2afc6dc72"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0c4ee7ffde1046f8b64d33b2afc6dc72"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0c4ee7ffde1046f8b64d33b2afc6dc72"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "2c11039bec844345b69625fd354cf77b"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "2c11039bec844345b69625fd354cf77b"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "2c11039bec844345b69625fd354cf77b"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "f224032989e6406db9986b5e8860c5e1"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "f224032989e6406db9986b5e8860c5e1"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f224032989e6406db9986b5e8860c5e1"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fe1ffb11e6ea4e2693b6f8e7e726130e"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "b64aea167aa143f096e788f162f40606"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "b8265697292940f092083731107005fe"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "29f3635e06ee4244835b5061b98d085d"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "29f3635e06ee4244835b5061b98d085d"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "29f3635e06ee4244835b5061b98d085d"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e0f5289e89d74331894b01ce6340fb4e"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e0f5289e89d74331894b01ce6340fb4e"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e0f5289e89d74331894b01ce6340fb4e"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "bfa5de0f0f504c24a0274047ea615c92", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e7f67306488d429f80aedea370128da5"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e7f67306488d429f80aedea370128da5"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e7f67306488d429f80aedea370128da5"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "de012b2839e949769e9b7518c6ba43da"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "de012b2839e949769e9b7518c6ba43da"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "de012b2839e949769e9b7518c6ba43da"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "23ca7b258e26422d978e2f856dc1fa6f"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "23ca7b258e26422d978e2f856dc1fa6f"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "23ca7b258e26422d978e2f856dc1fa6f"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "62926385b2f84221a3562c7c4c407edf"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "62926385b2f84221a3562c7c4c407edf"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "62926385b2f84221a3562c7c4c407edf"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "fbece4c56b6743ab8727b3e6f687ab5c"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "fbece4c56b6743ab8727b3e6f687ab5c"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "fbece4c56b6743ab8727b3e6f687ab5c"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fd8a5a2356a942b7ac0fa24882e55eb5"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "cf509073fb2e47008cb51d70292d387e"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "6ddf58af6dfb4abb8a9148e40467c53a"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "cb40d145f9f54ff7a4741646b027336e"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "cb40d145f9f54ff7a4741646b027336e"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "cb40d145f9f54ff7a4741646b027336e"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "5af5946f0772467baeeee203a1c2a77f"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "5af5946f0772467baeeee203a1c2a77f"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5af5946f0772467baeeee203a1c2a77f"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "bfeeae90a8594091a1163340beebe445", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a201bb25344e4ce1bd41607dfdc2e190"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a201bb25344e4ce1bd41607dfdc2e190"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a201bb25344e4ce1bd41607dfdc2e190"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "985e508414574e77a17eb3a10c9f0702"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "985e508414574e77a17eb3a10c9f0702"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "985e508414574e77a17eb3a10c9f0702"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "fc363c1ee2d9469cb408bc1ff76a7e05"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "fc363c1ee2d9469cb408bc1ff76a7e05"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fc363c1ee2d9469cb408bc1ff76a7e05"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "d639afd8304a496a965cb6b0c89b54c3"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "d639afd8304a496a965cb6b0c89b54c3"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "d639afd8304a496a965cb6b0c89b54c3"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "96f5ced0912b4b8890590925e53f477c"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "96f5ced0912b4b8890590925e53f477c"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "96f5ced0912b4b8890590925e53f477c"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f8e70b2bbd824789852088c507c2dca2"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "164ecac834054d1c8c5e704f9d400105"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "17274cc7a82640a78852b02aaed39b79"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"key": "value"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a8bb3deab13941eb82030b05422410ea"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a8bb3deab13941eb82030b05422410ea"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a8bb3deab13941eb82030b05422410ea"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "452d430a33994890b8d3cb1020c7f510"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "452d430a33994890b8d3cb1020c7f510"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "452d430a33994890b8d3cb1020c7f510"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "8817ec87a652433b9c3acfb608ba9d32", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6b766339258a4db585ea1a22247af7ab"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6b766339258a4db585ea1a22247af7ab"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6b766339258a4db585ea1a22247af7ab"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f0786c43e09e418ab312036d7baffe63"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f0786c43e09e418ab312036d7baffe63"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f0786c43e09e418ab312036d7baffe63"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "fb0b937fe6b040e4b6959362dffb2d9b"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "fb0b937fe6b040e4b6959362dffb2d9b"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fb0b937fe6b040e4b6959362dffb2d9b"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "f800ea61f391499fb4dee3b63b101d16"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "f800ea61f391499fb4dee3b63b101d16"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "f800ea61f391499fb4dee3b63b101d16"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "2c38f08020a842c08c22c7dde6b61fc8"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "2c38f08020a842c08c22c7dde6b61fc8"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "2c38f08020a842c08c22c7dde6b61fc8"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5b4dd122995b4732ab2f68f8b7df9c55"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "448cd323ab21429686c9580e7ed6fe18"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "b0be192eca72415a8fe710bf1a11cb70"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0815aad837294943899fc5a2d37319db"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0815aad837294943899fc5a2d37319db"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0815aad837294943899fc5a2d37319db"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "cf6d32f42e874ae3b8a716d72380b429"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "cf6d32f42e874ae3b8a716d72380b429"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "cf6d32f42e874ae3b8a716d72380b429"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:27+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "48758357727c4da4b6e454b0cb86909f", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "54414b12ae984af2a1c29eb7417c9abb"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "54414b12ae984af2a1c29eb7417c9abb"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "54414b12ae984af2a1c29eb7417c9abb"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "b98162b05284493b84bd8550a5e8ed29"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "b98162b05284493b84bd8550a5e8ed29"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b98162b05284493b84bd8550a5e8ed29"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "5608b7df0c734910898ce6c6b2a20e5e"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "5608b7df0c734910898ce6c6b2a20e5e"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5608b7df0c734910898ce6c6b2a20e5e"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "9679757be9b74119aee5ed6e4d361168"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "9679757be9b74119aee5ed6e4d361168"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "9679757be9b74119aee5ed6e4d361168"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "035366a5292843cea2b9ff1f6c9c91c9"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "035366a5292843cea2b9ff1f6c9c91c9"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "035366a5292843cea2b9ff1f6c9c91c9"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8259f218b85a4016a471bdd85afbf582"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "44f2e8f3964042dcad3b541bb7e56c60"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "c330e8ad62ff437f9c2320654396a89f"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound (fanout)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "2858130d6cc743438f58c26d69ee6b08"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "2858130d6cc743438f58c26d69ee6b08"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2858130d6cc743438f58c26d69ee6b08"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9f5b65a1cb754583bf6abf1752afdad6"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9f5b65a1cb754583bf6abf1752afdad6"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9f5b65a1cb754583bf6abf1752afdad6"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "c6c7774f15be45b1b70ff67e1619b20a", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "66d4d7023cd144bdb2065cf1d0ece6b5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "66d4d7023cd144bdb2065cf1d0ece6b5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "66d4d7023cd144bdb2065cf1d0ece6b5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "7b21788e1f76432289b8497d7e3fa7a0"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "7b21788e1f76432289b8497d7e3fa7a0"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "7b21788e1f76432289b8497d7e3fa7a0"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "8fce746b96b94fb99d4a07b6be2ecc18"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "8fce746b96b94fb99d4a07b6be2ecc18"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8fce746b96b94fb99d4a07b6be2ecc18"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "65ff7ef9eecc4743815c5f4b908cd201"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "65ff7ef9eecc4743815c5f4b908cd201"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "65ff7ef9eecc4743815c5f4b908cd201"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "998674a6ad9b4af3a4a2d8d6b9004ec5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "998674a6ad9b4af3a4a2d8d6b9004ec5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "998674a6ad9b4af3a4a2d8d6b9004ec5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5ea6e2f8e1c84fe68ab19e624af2dd7d"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "cf4dc863720f41d990a31b9a3a2d1e61"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "109e018038fd4742986314e2a4192f74"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:02+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "b6d1000375ee418fb43691f912eee72c"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "b6d1000375ee418fb43691f912eee72c"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b6d1000375ee418fb43691f912eee72c"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "d2f9f3f0a03e40acb9fbce3188325a28"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "d2f9f3f0a03e40acb9fbce3188325a28"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "d2f9f3f0a03e40acb9fbce3188325a28"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "d788389b8c0d420e9581b5b6b96d4489", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e8bbea804fb545e5b6f946a8e57177b0"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e8bbea804fb545e5b6f946a8e57177b0"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e8bbea804fb545e5b6f946a8e57177b0"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "228b68144429401487a7b82b8deae05d"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "228b68144429401487a7b82b8deae05d"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "228b68144429401487a7b82b8deae05d"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "30d311ce83964982addb59a9eac608f8"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "30d311ce83964982addb59a9eac608f8"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "30d311ce83964982addb59a9eac608f8"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "eeecd47612d94930aa88e206a5006e8e"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "eeecd47612d94930aa88e206a5006e8e"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "eeecd47612d94930aa88e206a5006e8e"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "63cddc1341584f408f7e42ae639eb915"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "63cddc1341584f408f7e42ae639eb915"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "63cddc1341584f408f7e42ae639eb915"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b670698d23bb4af2be0aa4868028c8f0"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "462beb623eb8471184cb8786ad2a1b22"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f2154bebc28e4a09be6d7a0eefba4e15"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:34+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "80ad243476f843e28c40a7498d4fd7dc"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "80ad243476f843e28c40a7498d4fd7dc"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "80ad243476f843e28c40a7498d4fd7dc"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "7d1b0cd8e0624889b7100856b0ebf9af"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "7d1b0cd8e0624889b7100856b0ebf9af"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "7d1b0cd8e0624889b7100856b0ebf9af"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "c80230a2527f43b9a840ab62ecbe16bb", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0ce2b7df44dd4021b01f6e372f77ab69"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0ce2b7df44dd4021b01f6e372f77ab69"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0ce2b7df44dd4021b01f6e372f77ab69"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f6ffbafa6eb9406ebaa6650ea35dbf84"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f6ffbafa6eb9406ebaa6650ea35dbf84"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f6ffbafa6eb9406ebaa6650ea35dbf84"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "2f85f3d00dd943fbb570d14544e77ae5"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "2f85f3d00dd943fbb570d14544e77ae5"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2f85f3d00dd943fbb570d14544e77ae5"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "17195266612a410e9e12a6482dd364d3"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "17195266612a410e9e12a6482dd364d3"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "17195266612a410e9e12a6482dd364d3"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "f341396d61f34b82aa2ffcc6937fdd06"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "f341396d61f34b82aa2ffcc6937fdd06"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f341396d61f34b82aa2ffcc6937fdd06"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6b3dc88ac5fe40d7b98dded4e44fdb47"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "870f1e9ef8b34ca1a9bb915df439c944"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "62903782270b4160a75050dbd525591f"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:47:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e5cfcefede5349d0bc0e62a29cb8f57f"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e5cfcefede5349d0bc0e62a29cb8f57f"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e5cfcefede5349d0bc0e62a29cb8f57f"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "d82e09110603425f82fbd561c2ec8711"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "d82e09110603425f82fbd561c2ec8711"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "d82e09110603425f82fbd561c2ec8711"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:39+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "07d97fd52a124197bf0b7a09ad563010", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "087c14ed9e43429f8f38df7283ea6e41"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "087c14ed9e43429f8f38df7283ea6e41"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "087c14ed9e43429f8f38df7283ea6e41"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "1e30888360774b79b309171d00a5695c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "1e30888360774b79b309171d00a5695c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "1e30888360774b79b309171d00a5695c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "66c916d300c34049b29a2e0cc1bc6a42"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "66c916d300c34049b29a2e0cc1bc6a42"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "66c916d300c34049b29a2e0cc1bc6a42"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "2fa8e31ab2e74746a99fbdc0ff1e6c1c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "2fa8e31ab2e74746a99fbdc0ff1e6c1c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "2fa8e31ab2e74746a99fbdc0ff1e6c1c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "367c9c2625f9457ebf8d5272deaf9a62"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "367c9c2625f9457ebf8d5272deaf9a62"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "367c9c2625f9457ebf8d5272deaf9a62"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "27a7b359c87a40e1ad1f44f97033e900"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "548d7e34cdf24851aee7b2af3c415ee4"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "c0e32c940e4845aaac57fde9e90f4735"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:40+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "1ba5dce567524fa0b4f6ee3e5a2a1fb9"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "1ba5dce567524fa0b4f6ee3e5a2a1fb9"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "1ba5dce567524fa0b4f6ee3e5a2a1fb9"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "918b133fa30d4adeb15e601f151b1540"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "918b133fa30d4adeb15e601f151b1540"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "918b133fa30d4adeb15e601f151b1540"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "8d18b04d53684ee58b70035123063bad", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f711277a82234a3db091ce69845b2cd1"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f711277a82234a3db091ce69845b2cd1"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f711277a82234a3db091ce69845b2cd1"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "4e1aec970ba14918ab747ac80cdbd293"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "4e1aec970ba14918ab747ac80cdbd293"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "4e1aec970ba14918ab747ac80cdbd293"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ca8983d08a304a52ab6e2a1dfdd3750c"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ca8983d08a304a52ab6e2a1dfdd3750c"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ca8983d08a304a52ab6e2a1dfdd3750c"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "8152fb31973649f9a3f818cf8d56b542"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "8152fb31973649f9a3f818cf8d56b542"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "8152fb31973649f9a3f818cf8d56b542"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "e93b184c68e54eebb264bad672ba5b0d"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "e93b184c68e54eebb264bad672ba5b0d"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "e93b184c68e54eebb264bad672ba5b0d"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "48de8acd372b40d9a4fd1db1a8a447da"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "80c67bdc09844d2da5c6733ea5c1e7ee"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "2d381f8293b841b2b3b0630637ce2a37"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:48:29+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "557019db621044ad96ff56f322f84075"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "557019db621044ad96ff56f322f84075"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "557019db621044ad96ff56f322f84075"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "767bee99bbe941f1b4b6787b4461f4ff"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "767bee99bbe941f1b4b6787b4461f4ff"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "767bee99bbe941f1b4b6787b4461f4ff"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:07+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "2b03e67f13c34c02a6ae58580b8ca88d", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "84f717e5954e42d2ab5bf80c7f57c909"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "84f717e5954e42d2ab5bf80c7f57c909"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "84f717e5954e42d2ab5bf80c7f57c909"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "02f8e22cf0644408a0e0b427c264652b"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "02f8e22cf0644408a0e0b427c264652b"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "02f8e22cf0644408a0e0b427c264652b"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ba665d7ef1a149859a4faff03f60bd54"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ba665d7ef1a149859a4faff03f60bd54"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ba665d7ef1a149859a4faff03f60bd54"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "fee0ab4b5e004505b4928ceb87f04698"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "fee0ab4b5e004505b4928ceb87f04698"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "fee0ab4b5e004505b4928ceb87f04698"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "04161bc3252b4d929c3551668390c809"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "04161bc3252b4d929c3551668390c809"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "04161bc3252b4d929c3551668390c809"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "27134d8a833340c4b953fa30fe7ec50d"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "9b4ed14b39384ded9b5ec91aa10afe50"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "a7745c7c78ec49b491a852af8748c350"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:50:08+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.cff1d447372c4b3d8dd7f0e387881331'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a36c00caf65845f5aee0176b34b90103"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a36c00caf65845f5aee0176b34b90103"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a36c00caf65845f5aee0176b34b90103"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9ab81c64aa6a40fb9c6b675bb14d15d6"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9ab81c64aa6a40fb9c6b675bb14d15d6"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9ab81c64aa6a40fb9c6b675bb14d15d6"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "eec538ae07e94bdbb7b31cb04bcc9865", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "5f1706681bbb48f488f7b5a630facebc"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "5f1706681bbb48f488f7b5a630facebc"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5f1706681bbb48f488f7b5a630facebc"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "281c3993cad74873a5f86c7c3c9aa482"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "281c3993cad74873a5f86c7c3c9aa482"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "281c3993cad74873a5f86c7c3c9aa482"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "3255c20fda8648a7a3462ae00999c974"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "3255c20fda8648a7a3462ae00999c974"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "3255c20fda8648a7a3462ae00999c974"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "5c694834fcb24139a49fd2f0db96e9e4"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "5c694834fcb24139a49fd2f0db96e9e4"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "5c694834fcb24139a49fd2f0db96e9e4"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "02964febd2dd488e9d79f7d1333434b2"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "02964febd2dd488e9d79f7d1333434b2"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "02964febd2dd488e9d79f7d1333434b2"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ecccaa5b218a4518b6095ed881092712"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "f8470ab79922432294327096377cddaf"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "328c8e0625ac42a6802917c723566846"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:54:26+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6656a1e5f4504117969c1a07d63e8831"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6656a1e5f4504117969c1a07d63e8831"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6656a1e5f4504117969c1a07d63e8831"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "489cd1e9105d48648356a93dceb1ef23"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "489cd1e9105d48648356a93dceb1ef23"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "489cd1e9105d48648356a93dceb1ef23"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "d5fd7be9555f45cd94b9878d6563f5a9", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "52ecc8a59fcb4770a4085bace4af6542"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "52ecc8a59fcb4770a4085bace4af6542"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "52ecc8a59fcb4770a4085bace4af6542"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "175fef45c917465793ae16dec1f4a666"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "175fef45c917465793ae16dec1f4a666"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "175fef45c917465793ae16dec1f4a666"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "b3087995de884ee5b2f53137fcbb1eb3"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "b3087995de884ee5b2f53137fcbb1eb3"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b3087995de884ee5b2f53137fcbb1eb3"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "ba4aed4bbf114251bb1ce9b7af49c377"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "ba4aed4bbf114251bb1ce9b7af49c377"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "ba4aed4bbf114251bb1ce9b7af49c377"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "0a2eee5448c44e70af1bb5108e782c15"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "0a2eee5448c44e70af1bb5108e782c15"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "0a2eee5448c44e70af1bb5108e782c15"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "df540da635ce4305b781b34c751cd013"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "14f659062a6b4986b407c1e098d57c48"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "7907046f91bd4652aefcfbe3f759d42e"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Handler error rk=pattern1", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 125, in start_consumer\n    await handler(payload, rk)\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\ntest_rabbitmq.StopConsumer"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.c5422b0096c44283959030a11518690f'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "bd2ea35b34ed4ac3b249e5a39ab2241f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "bd2ea35b34ed4ac3b249e5a39ab2241f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bd2ea35b34ed4ac3b249e5a39ab2241f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "eb950cec38814aee9971e861086d899b"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "eb950cec38814aee9971e861086d899b"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "eb950cec38814aee9971e861086d899b"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "8e496c09c00e48c29887b218675e9be3", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "41b36d0927af49af8619c2ad08a0206a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "41b36d0927af49af8619c2ad08a0206a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "41b36d0927af49af8619c2ad08a0206a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "133af3e16e1244ebb6c04b87d396de0a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "133af3e16e1244ebb6c04b87d396de0a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "133af3e16e1244ebb6c04b87d396de0a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6504ade85c4341ab8c2f03d43603f47f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6504ade85c4341ab8c2f03d43603f47f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6504ade85c4341ab8c2f03d43603f47f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "dedbc4a1a4ad48f6a13be2c6c42490aa"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "dedbc4a1a4ad48f6a13be2c6c42490aa"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "dedbc4a1a4ad48f6a13be2c6c42490aa"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "43e626fb954f45b4b90892dd5e874d13"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "43e626fb954f45b4b90892dd5e874d13"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "43e626fb954f45b4b90892dd5e874d13"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f45a18e3bd894edc9b945817f1ca4d10"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "182a891bd44e419282327ff58e899cf6"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "febb5c9af77643ee88c517899c3c21d2"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T14:06:35+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.f8868126926247f9a23b6fa4933dd2c3'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
