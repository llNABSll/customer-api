{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:26:18+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:27:33+0000", "level": "ERROR", "logger": "app.core.database", "msg": "db session rolled back due to exception", "service": "customer-api", "request_id": "594d67978a45437f82131492e1f226a9", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/core/database.py\", line 54, in get_db\n    yield db\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/concurrency.py\", line 27, in contextmanager_in_threadpool\n    yield await run_in_threadpool(cm.__enter__)\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 215, in run_endpoint_function\n    return await run_in_threadpool(dependant.call, **values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2476, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 967, in run\n    result = context.run(func, *args)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/api/routes.py\", line 68, in list_customers\n    rows = svc.list(\n           ^^^^^^^^^\nTypeError: CustomerService.list() got an unexpected keyword argument 'q'"}
{"ts": "2025-09-08T21:27:33+0000", "level": "ERROR", "logger": "uvicorn.error", "msg": "Exception in ASGI application\n", "service": "customer-api", "request_id": "-", "exc_info": "  + Exception Group Traceback (most recent call last):\n  |   File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 79, in collapse_excgroups\n  |     yield\n  |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 183, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 772, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 409, in run_asgi\n    |     result = await app(  # type: ignore[func-returns-value]\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    |     return await self.app(scope, receive, send)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/applications.py\", line 113, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |   File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/app/app/main.py\", line 96, in metrics_middleware\n    |     response: Response = await call_next(request)\n    |                          ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    |     raise app_exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    |     with recv_stream, send_stream, collapse_excgroups():\n    |   File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(typ, value, traceback)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    |     raise exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/app/app/core/logging.py\", line 164, in access_log_middleware\n    |     response: Response = await call_next(request)\n    |                          ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    |     raise app_exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 716, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 736, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 290, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 78, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     raise exc\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 75, in app\n    |     response = await f(request)\n    |                ^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 302, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 215, in run_endpoint_function\n    |     return await run_in_threadpool(dependant.call, **values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    |     return await anyio.to_thread.run_sync(func)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    |     return await get_async_backend().run_sync_in_worker_thread(\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2476, in run_sync_in_worker_thread\n    |     return await future\n    |            ^^^^^^^^^^^^\n    |   File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 967, in run\n    |     result = context.run(func, *args)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/app/app/api/routes.py\", line 68, in list_customers\n    |     rows = svc.list(\n    |            ^^^^^^^^^\n    | TypeError: CustomerService.list() got an unexpected keyword argument 'q'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 409, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/applications.py\", line 113, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/main.py\", line 96, in metrics_middleware\n    response: Response = await call_next(request)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/core/logging.py\", line 164, in access_log_middleware\n    response: Response = await call_next(request)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 215, in run_endpoint_function\n    return await run_in_threadpool(dependant.call, **values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2476, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 967, in run\n    result = context.run(func, *args)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/api/routes.py\", line 68, in list_customers\n    rows = svc.list(\n           ^^^^^^^^^\nTypeError: CustomerService.list() got an unexpected keyword argument 'q'"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:28:55+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:29:46+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:14+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:33:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:36:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:37:59+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:07+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:38:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:39:24+0000", "level": "ERROR", "logger": "app.core.database", "msg": "db session rolled back due to exception", "service": "customer-api", "request_id": "eec751eb8bf64ca398ee7dfd427b7084", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 951, in do_execute\n    cursor.execute(statement, parameters)\npsycopg2.errors.UndefinedColumn: column clients.created_at does not exist\nLINE 1: ... clients_company, clients.phone AS clients_phone, clients.cr...\n                                                             ^\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/core/database.py\", line 54, in get_db\n    yield db\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/concurrency.py\", line 27, in contextmanager_in_threadpool\n    yield await run_in_threadpool(cm.__enter__)\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 215, in run_endpoint_function\n    return await run_in_threadpool(dependant.call, **values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2476, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 967, in run\n    result = context.run(func, *args)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/api/routes.py\", line 69, in list_customers\n    rows = svc.list(\n           ^^^^^^^^^\n  File \"/app/app/services/client_service.py\", line 77, in list\n    return query.offset(skip).limit(limit).all()\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2704, in all\n    return self._iter().all()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2857, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2365, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2251, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 306, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1419, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 526, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1641, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 951, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column clients.created_at does not exist\nLINE 1: ... clients_company, clients.phone AS clients_phone, clients.cr...\n                                                             ^\n\n[SQL: SELECT clients.id AS clients_id, clients.name AS clients_name, clients.email AS clients_email, clients.company AS clients_company, clients.phone AS clients_phone, clients.created_at AS clients_created_at, clients.updated_at AS clients_updated_at, clients.version AS clients_version \nFROM clients ORDER BY clients.id \n LIMIT %(param_1)s OFFSET %(param_2)s]\n[parameters: {'param_1': 10, 'param_2': 0}]\n(Background on this error at: https://sqlalche.me/e/20/f405)"}
{"ts": "2025-09-08T21:39:24+0000", "level": "ERROR", "logger": "uvicorn.error", "msg": "Exception in ASGI application\n", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 951, in do_execute\n    cursor.execute(statement, parameters)\npsycopg2.errors.UndefinedColumn: column clients.created_at does not exist\nLINE 1: ... clients_company, clients.phone AS clients_phone, clients.cr...\n                                                             ^\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 409, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py\", line 60, in __call__\n    return await self.app(scope, receive, send)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/applications.py\", line 113, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/main.py\", line 96, in metrics_middleware\n    response: Response = await call_next(request)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 182, in __call__\n    with recv_stream, send_stream, collapse_excgroups():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 184, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/core/logging.py\", line 164, in access_log_middleware\n    response: Response = await call_next(request)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 215, in run_endpoint_function\n    return await run_in_threadpool(dependant.call, **values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/concurrency.py\", line 38, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2476, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 967, in run\n    result = context.run(func, *args)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/api/routes.py\", line 69, in list_customers\n    rows = svc.list(\n           ^^^^^^^^^\n  File \"/app/app/services/client_service.py\", line 77, in list\n    return query.offset(skip).limit(limit).all()\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2704, in all\n    return self._iter().all()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2857, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2365, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2251, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 306, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1419, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 526, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1641, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 951, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column clients.created_at does not exist\nLINE 1: ... clients_company, clients.phone AS clients_phone, clients.cr...\n                                                             ^\n\n[SQL: SELECT clients.id AS clients_id, clients.name AS clients_name, clients.email AS clients_email, clients.company AS clients_company, clients.phone AS clients_phone, clients.created_at AS clients_created_at, clients.updated_at AS clients_updated_at, clients.version AS clients_version \nFROM clients ORDER BY clients.id \n LIMIT %(param_1)s OFFSET %(param_2)s]\n[parameters: {'param_1': 10, 'param_2': 0}]\n(Background on this error at: https://sqlalche.me/e/20/f405)"}
{"ts": "2025-09-08T21:43:38+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "edf50211a5e24c3ba8b5418c63d8d56d"}
{"ts": "2025-09-08T21:43:38+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk='%s' payload=%s", "service": "customer-api", "request_id": "edf50211a5e24c3ba8b5418c63d8d56d"}
{"ts": "2025-09-08T21:43:38+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "edf50211a5e24c3ba8b5418c63d8d56d"}
{"ts": "2025-09-08T21:43:38+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "edf50211a5e24c3ba8b5418c63d8d56d"}
{"ts": "2025-09-08T21:45:10+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:47:00+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:49:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:50:10+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:51:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:11+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:52:38+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:53:43+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a348a4ba5c1a4a888fbe6b3f2945f065"}
{"ts": "2025-09-08T21:53:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk='%s' payload=%s", "service": "customer-api", "request_id": "a348a4ba5c1a4a888fbe6b3f2945f065"}
{"ts": "2025-09-08T21:53:43+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a348a4ba5c1a4a888fbe6b3f2945f065"}
{"ts": "2025-09-08T21:53:43+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a348a4ba5c1a4a888fbe6b3f2945f065"}
{"ts": "2025-09-08T21:58:51+0000", "level": "ERROR", "logger": "aiormq.connection", "msg": "Unexpected connection close from remote \"%s\", Connection.Close(reply_code=%r, reply_text=%r)", "service": "customer-api", "request_id": "-", "exc_info": "NoneType: None"}
{"ts": "2025-09-08T21:58:51+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to %s closed. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:58:51+0000", "level": "ERROR", "logger": "aio_pika.tools", "msg": "Callback %r error", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/tools.py\", line 306, in __task_inner\n    await self.callback(*args, **kwargs)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 119, in _on_close\n    await self.restore()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 94, in restore\n    await self.reopen()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 132, in reopen\n    await super().reopen()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/channel.py\", line 244, in reopen\n    await self._open()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/channel.py\", line 173, in _open\n    channel = await UnderlayChannel.create(\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/abc.py\", line 485, in create\n    channel = await connection.channel(**kwargs)\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 918, in channel\n    raise RuntimeError(\"%r closed\" % self)\nRuntimeError: <Connection: \"amqp://app:******@rabbitmq:5672/%2F\" at 0x7f5584f1eb20> closed"}
{"ts": "2025-09-08T21:58:51+0000", "level": "ERROR", "logger": "aio_pika.tools", "msg": "Callback %r error", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/tools.py\", line 306, in __task_inner\n    await self.callback(*args, **kwargs)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 119, in _on_close\n    await self.restore()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 94, in restore\n    await self.reopen()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_channel.py\", line 132, in reopen\n    await super().reopen()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/channel.py\", line 244, in reopen\n    await self._open()\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/channel.py\", line 169, in _open\n    raise ChannelInvalidStateError(\"No active transport in channel\")\naiormq.exceptions.ChannelInvalidStateError: No active transport in channel"}
{"ts": "2025-09-08T21:58:51+0000", "level": "ERROR", "logger": "aiormq.connection", "msg": "error when creating transport: %r", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:58:51+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to %s closed. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:58:51+0000", "level": "WARNING", "logger": "aio_pika.robust_connection", "msg": "Connection attempt to \"%s\" failed: %s. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:04+0000", "level": "ERROR", "logger": "aiormq.connection", "msg": "error when creating transport: %r", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:04+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to %s closed. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:04+0000", "level": "WARNING", "logger": "aio_pika.robust_connection", "msg": "Connection attempt to \"%s\" failed: %s. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:08+0000", "level": "ERROR", "logger": "aiormq.connection", "msg": "error when creating transport: %r", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:08+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to %s closed. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:08+0000", "level": "WARNING", "logger": "aio_pika.robust_connection", "msg": "Connection attempt to \"%s\" failed: %s. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:13+0000", "level": "ERROR", "logger": "aiormq.connection", "msg": "error when creating transport: %r", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:13+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to %s closed. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:13+0000", "level": "WARNING", "logger": "aio_pika.robust_connection", "msg": "Connection attempt to \"%s\" failed: %s. Reconnecting after %r seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:17+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:17+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:17+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:17+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T21:59:17+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange '%s' (%s) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on %s://%s:%d (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:03+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue %s bound to pattern %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:00:53+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "46df3276027347099b633b1150364f72"}
{"ts": "2025-09-08T22:00:53+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk='%s' payload=%s", "service": "customer-api", "request_id": "46df3276027347099b633b1150364f72"}
{"ts": "2025-09-08T22:00:53+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "46df3276027347099b633b1150364f72"}
{"ts": "2025-09-08T22:00:53+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "46df3276027347099b633b1150364f72"}
{"ts": "2025-09-08T22:03:01+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:05:59+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6549b4c0460f402ca37d2b9813ab250d"}
{"ts": "2025-09-08T22:05:59+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk='%s' payload=%s", "service": "customer-api", "request_id": "6549b4c0460f402ca37d2b9813ab250d"}
{"ts": "2025-09-08T22:05:59+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6549b4c0460f402ca37d2b9813ab250d"}
{"ts": "2025-09-08T22:05:59+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6549b4c0460f402ca37d2b9813ab250d"}
{"ts": "2025-09-08T22:06:10+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:07:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a506900b2b25431390bad75c3228b489"}
{"ts": "2025-09-08T22:07:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk='%s' payload=%s", "service": "customer-api", "request_id": "a506900b2b25431390bad75c3228b489"}
{"ts": "2025-09-08T22:07:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a506900b2b25431390bad75c3228b489"}
{"ts": "2025-09-08T22:07:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a506900b2b25431390bad75c3228b489"}
{"ts": "2025-09-08T22:07:41+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received %s: %s", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-08T22:12:30+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [%d]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to amqp://guest:******@rabbitmq:5672/%2F closed. Reconnecting after 5 seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "ERROR", "logger": "customer-api", "msg": "RabbitMQ startup failed", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/abc.py\", line 44, in __inner\n    return await self.task\n           ^^^^^^^^^^^^^^^\nasyncio.exceptions.CancelledError\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/main.py\", line 51, in lifespan\n    await rabbitmq.connect()\n  File \"/app/app/infra/events/rabbitmq.py\", line 40, in connect\n    self.connection = await aio_pika.connect_robust(self.url)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 340, in connect_robust\n    await connection.connect(timeout=timeout)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 186, in connect\n    await self.__fail_fast_future\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 141, in __connection_factory\n    await Connection.connect(self, self.__connect_timeout)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/connection.py\", line 118, in connect\n    self.transport = await UnderlayConnection.connect(\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/abc.py\", line 671, in connect\n    connection = await cls.make_connection(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/abc.py\", line 659, in make_connection\n    connection: aiormq.abc.AbstractConnection = await asyncio.wait_for(\n                                                ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/asyncio/tasks.py\", line 452, in wait_for\n    return await fut\n           ^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 920, in connect\n    await connection.connect(client_properties or {})\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/base.py\", line 164, in wrap\n    return await self.create_task(func(self, *args, **kwargs))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/abc.py\", line 46, in __inner\n    raise self._exception from e\n  File \"/usr/local/lib/python3.11/asyncio/tasks.py\", line 694, in _wrap_awaitable\n    return (yield from awaitable.__await__())\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/abc.py\", line 46, in __inner\n    raise self._exception from e\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 484, in connect\n    frame = await self._rpc(\n            ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 436, in _rpc\n    raise ProbableAuthenticationError(frame.reply_text)\naiormq.exceptions.ProbableAuthenticationError: ACCESS_REFUSED - Login was refused using authentication mechanism PLAIN. For details see the broker logfile."}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:33:33+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:37:18+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:37:19+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:37:19+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:37:19+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:27+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:27+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:27+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:28+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:28+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:32+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "09f50e3dd16f4214a5f6cc0a509a5f28", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T10:38:33+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "b42b7eb964e4412dbf91e513e470077d", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T10:38:34+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "7baa580c8d73444a9b821f2a0a24cb6e", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T10:38:34+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "29ab6f85f9cf4a5b971018262f652e01", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T10:38:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f40ed650fa244510bd6dbc21b80c9672"}
{"ts": "2025-09-09T10:38:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "03d5012d561140ca9dba8109cae21fa3"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T10:38:36+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to amqp://app:******@rabbitmq:5672/%2F closed. Reconnecting after 5 seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:31:29+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.9b1dc38c2b3f46d8aa6bc5845939bb55'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:10+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "8dbe1e1f308a4bed8c21b9e800581c53", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:32:11+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "d5c11f65601b457eb655dadf3982526e", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:32:12+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "19c8eb37df08454c937fc3332308123d", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:32:13+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "b384df4511bd482f8e1c461710a996b1", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:32:14+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e6e2e8c47c3d4b7c9e62e1ad38e634b0"}
{"ts": "2025-09-09T11:32:14+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:14+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:14+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:14+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "8da7bbd34ce149e18488f2f9a1c4c41f"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:15+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:32:16+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:38:51+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.8f7bc4eec1c448edb45105ff2d37c0d0'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:36+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "8fc76747a412477e9e480353be011c97", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:39:37+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "851d1bda503e4bd18bbc7d71e952fde1", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:39:38+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "9d82b94a81924d98929ba02ce87b46e6", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:39:39+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "f71c87e1644147aca3fddbc6e629aa30", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:40+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T11:39:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:39:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:40:50+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.83f32c2181f24530ad57a5ac15c1b0e4'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:52:59+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "4d7efc6b7bde46fa997669e3c736ff70", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:53:00+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "01a8c6306ebf482b9752310718f7aeb1", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:53:01+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "10360d7999424e8aa074ff69c7c9a47e", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:53:02+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "09b6c9bedf5e40d1933eb267de3dae6d", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9c649913450f4d3387e2767130618e41"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "fbaffdbd14de4da293ce906a7d577aef"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "3bfb437b3b234e19a8de6a45417279be"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:04+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:53:06+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:05+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.ae883b6f3cf346fcbbf5c588960e7961'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:40+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "bf34e21f96764bddb038a333ac3bba67", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:56:42+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "b037e695da754691b628498b39077dcc", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:56:42+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "c160029c9ac045a7abd3461386c62f08", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:56:43+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "6633bb1bd8df4d7eaac19c663125a208", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T11:56:44+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b8dd456189fc4cd3aa1cfc4dabf9ed1f"}
{"ts": "2025-09-09T11:56:44+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:44+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:44+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "c0222e34960e43dea0b931b1f6fd10eb"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f565fb578f8b47eb8615f5f68076cca2"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 18, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:45+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T11:56:48+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:04:39+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.4837e35f07e243e2aa50dc8724bb56c0'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:17+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "2312c773aee84dbaacf87389170beb54", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T12:08:18+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "6982cbef5ae94f358ea563c5ca4446df", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T12:08:19+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "24644c1c4923433fa0fe316bb2c51dc7", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T12:08:21+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "505549568340420ab9ea97bfd13a8347", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "57b3412e22b4436aa4f8ac2f55dc0753"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "2453f8d070a4478c86682c32808962ed"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "eddfa9f5c7a842be9007844ca8574ba2"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:22+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:24+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:24+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:25+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:25+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:25+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:08:25+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:14:40+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.7b79182181144e3c9510b92e78bc0de5'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "55018b344ddc4e3eafa16a199c49716c"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "55018b344ddc4e3eafa16a199c49716c"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "55018b344ddc4e3eafa16a199c49716c"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "99c66eb64f1d4cbaab071b4a112b6370"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "99c66eb64f1d4cbaab071b4a112b6370"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "99c66eb64f1d4cbaab071b4a112b6370"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "7c040c3ffa894b90a2a29b867bd232f7", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "c67efb87a853497a8b2736392b5af894"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "c67efb87a853497a8b2736392b5af894"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "c67efb87a853497a8b2736392b5af894"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ef97a0acde6e49d6821467ae56e820c6"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ef97a0acde6e49d6821467ae56e820c6"}
{"ts": "2025-09-09T12:15:18+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ef97a0acde6e49d6821467ae56e820c6"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "02488c402ae1473d81d4715319fec87c"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "02488c402ae1473d81d4715319fec87c"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "02488c402ae1473d81d4715319fec87c"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "24c9d7573aa4485b9113e2962c018e68"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "24c9d7573aa4485b9113e2962c018e68"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "24c9d7573aa4485b9113e2962c018e68"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "8753d9f9071b4ac1a7ab0af3e88b0270"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "8753d9f9071b4ac1a7ab0af3e88b0270"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "8753d9f9071b4ac1a7ab0af3e88b0270"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ab6ea3aab3a74e898971ba04868fe0ca"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "085043d233dd4e8d9aa430dca8db6564"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "dc1bd1e4b2384fd0a52920f81031e8b8"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:19+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:15:24+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:17:39+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.52ca604f7d9741358861eb93175390ba'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ce2b7c07fc6f4851aafc226f6fdd8c5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ce2b7c07fc6f4851aafc226f6fdd8c5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ce2b7c07fc6f4851aafc226f6fdd8c5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e5be47a1db36464487fffcb054f71cac"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e5be47a1db36464487fffcb054f71cac"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e5be47a1db36464487fffcb054f71cac"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "4a253ef40a234ad1adaa665d73c78d6d", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "be048c6d0d22413196579ece9059f0b1"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "be048c6d0d22413196579ece9059f0b1"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "be048c6d0d22413196579ece9059f0b1"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e7b1d1d5009e4b2f983ab0de10a1181f"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e7b1d1d5009e4b2f983ab0de10a1181f"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e7b1d1d5009e4b2f983ab0de10a1181f"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "67c228d2551b45aeaf9b0eda4fd0c6a7"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "67c228d2551b45aeaf9b0eda4fd0c6a7"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "67c228d2551b45aeaf9b0eda4fd0c6a7"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "f5fa8f2568dc443699ec4b489de20e5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "f5fa8f2568dc443699ec4b489de20e5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "f5fa8f2568dc443699ec4b489de20e5b"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "d32d14c98c4f4e2cafc318decca4d2b6"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "d32d14c98c4f4e2cafc318decca4d2b6"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "d32d14c98c4f4e2cafc318decca4d2b6"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "1d376cfb32e04f63818ce16b2a5a7b97"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "3d38b4561be14cf39c9115fe065aeb7f"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "562bae25ea12467588ded5a6dc2daeb0"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:27+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:28:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:06+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "fd53f06477dd45bea2c63b43a2713bd7"}
{"ts": "2025-09-09T14:33:06+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "fd53f06477dd45bea2c63b43a2713bd7"}
{"ts": "2025-09-09T14:33:06+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fd53f06477dd45bea2c63b43a2713bd7"}
{"ts": "2025-09-09T14:33:06+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:06+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0f372bf2c17f4cf2874b79205b13b05c"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0f372bf2c17f4cf2874b79205b13b05c"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0f372bf2c17f4cf2874b79205b13b05c"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "2a7ff6297db64bffbc5237ed2f90b638", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "eea7deabcae94a4a879e30d27fd400d3"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "eea7deabcae94a4a879e30d27fd400d3"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "eea7deabcae94a4a879e30d27fd400d3"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "707a1e9887e64118b86ef63db5897652"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "707a1e9887e64118b86ef63db5897652"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "707a1e9887e64118b86ef63db5897652"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "dfdf92778b91460889ff9632fb2f325d"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "dfdf92778b91460889ff9632fb2f325d"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "dfdf92778b91460889ff9632fb2f325d"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "ac07a39d99f344ee84c940e642b09772"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "ac07a39d99f344ee84c940e642b09772"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "ac07a39d99f344ee84c940e642b09772"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "0a19f8a6fc1f43c397f622bae77cb858"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "0a19f8a6fc1f43c397f622bae77cb858"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "0a19f8a6fc1f43c397f622bae77cb858"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "eaf7cb903f1140959380b3d6ccf1ffa0"}
{"ts": "2025-09-09T14:33:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "db33e54c657c4b21b3e4a9449de87771"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "a3d74f5c551043078d3e011ada6cd8a6"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:08+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0b4de911ce9940d99d8edf878c11b112"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0b4de911ce9940d99d8edf878c11b112"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0b4de911ce9940d99d8edf878c11b112"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a7a1dca10eef4e52a88452289dc75edd"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a7a1dca10eef4e52a88452289dc75edd"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a7a1dca10eef4e52a88452289dc75edd"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "431608b4851c4ab7881e703430b0fec4", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "2da32e542f9648d2b8f9fa0a80f81566"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "2da32e542f9648d2b8f9fa0a80f81566"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2da32e542f9648d2b8f9fa0a80f81566"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6270469eb82c4e2b87a178b92e26b4bf"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6270469eb82c4e2b87a178b92e26b4bf"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6270469eb82c4e2b87a178b92e26b4bf"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f8b4869a85d94542867a8a7bc2fc8c64"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f8b4869a85d94542867a8a7bc2fc8c64"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f8b4869a85d94542867a8a7bc2fc8c64"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "50d8b62b0be84e22913d1f3de2c16be4"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "50d8b62b0be84e22913d1f3de2c16be4"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "50d8b62b0be84e22913d1f3de2c16be4"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "f4972da9a71d432d9f15403c82b58efc"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "f4972da9a71d432d9f15403c82b58efc"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f4972da9a71d432d9f15403c82b58efc"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e263aaad5bba4955b708281c5b48cb15"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "f835fe4788e94f43af2f92866812fa73"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "0fddfecd47354cc18b71ef06b7199c99"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:33:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "8c1413a1d7094080bc2c75d80ca7bb48"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "8c1413a1d7094080bc2c75d80ca7bb48"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8c1413a1d7094080bc2c75d80ca7bb48"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0f68215af9824fd2a1174f73d5403525"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0f68215af9824fd2a1174f73d5403525"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0f68215af9824fd2a1174f73d5403525"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "0ea09f9bcc1f4f96ba0f876c02bab429", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "524440ebbb92434f95cd11e78a2a8ba9"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "524440ebbb92434f95cd11e78a2a8ba9"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "524440ebbb92434f95cd11e78a2a8ba9"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "33173d68eada4e2087174b6d9b006cc8"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "33173d68eada4e2087174b6d9b006cc8"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "33173d68eada4e2087174b6d9b006cc8"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9d1b48266598496ea6d0e308e98952a2"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9d1b48266598496ea6d0e308e98952a2"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9d1b48266598496ea6d0e308e98952a2"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/4 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "3e587014b3424c169e2d311075896e02"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "3e587014b3424c169e2d311075896e02"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "3e587014b3424c169e2d311075896e02"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/4 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/4 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "6b4218e3b09f49bda31a890ec5f1850c"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "6b4218e3b09f49bda31a890ec5f1850c"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "6b4218e3b09f49bda31a890ec5f1850c"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/4 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/4 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2feb789478f7412285f713a9c3b040a4"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "c6377b95af2d4791bf79d4a94910e3a1"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "3fa627c6c0be4e32b0fa461373667ad2"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "53425f55e9ff478f8c611febfd373522"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "53425f55e9ff478f8c611febfd373522"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "53425f55e9ff478f8c611febfd373522"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "607e594fd2ce4518b48fa66029142a83"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "607e594fd2ce4518b48fa66029142a83"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "607e594fd2ce4518b48fa66029142a83"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "7bb1cc4ce1364b4a9582896abaf20454", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9912b780bdaa486e80f61627e23053dd"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9912b780bdaa486e80f61627e23053dd"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9912b780bdaa486e80f61627e23053dd"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "4bfbf6c252734f59959bb9aad85e8492"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "4bfbf6c252734f59959bb9aad85e8492"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "4bfbf6c252734f59959bb9aad85e8492"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "bd607fa4531e43a080468fd6d4d07880"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "bd607fa4531e43a080468fd6d4d07880"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bd607fa4531e43a080468fd6d4d07880"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "a3bd8cfa7f4d49d8b047cc572f0fdebb"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "a3bd8cfa7f4d49d8b047cc572f0fdebb"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "a3bd8cfa7f4d49d8b047cc572f0fdebb"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "ba08b607b0fd4d80a26323f0daf4dcf4"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "ba08b607b0fd4d80a26323f0daf4dcf4"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "ba08b607b0fd4d80a26323f0daf4dcf4"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a14d1908842d4b6cb7394cb31467e2e1"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "f8c1f6f13fb54d09b72d2f40bf632deb"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "95694ec167fc4f2985efb2a661f40fa3"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:24+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:44+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "7c598abdcd164586bc8029ebc63ba9e9", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('John Doe', 'john.doe@test.com', 'Doe Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T14:34:45+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "0979ed3473e14459910171519f39059e", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T14:34:46+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "a2de91a1a93940048a1f081abc2df8e1", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Alice', 'alice@test.com', 'A Corp', None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T14:34:48+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "7ab1c0dae14a4fe799156914ac633744", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.OperationalError: no such table: clients\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: clients\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Lifecycle User', 'lifecycle@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e708b7c910a34e75bdf80c5a5e769c95"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "6ab9753a8b03468abbb11eade5f3eec7"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "2c2b98cc06fa49e9bd9ea1d1c6b9e174"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:34:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "86866327a4e04e6aa8ec57986226f258"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "86866327a4e04e6aa8ec57986226f258"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "86866327a4e04e6aa8ec57986226f258"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6fdfb95914c94cfe8df099c2f6254076"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6fdfb95914c94cfe8df099c2f6254076"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6fdfb95914c94cfe8df099c2f6254076"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "f28f10c102ce4beba2d381a68a02598d", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f21631340904487f86a5b240454ec15a"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f21631340904487f86a5b240454ec15a"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f21631340904487f86a5b240454ec15a"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "bced5fa9211e4c1db17a55c4f500e167"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "bced5fa9211e4c1db17a55c4f500e167"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bced5fa9211e4c1db17a55c4f500e167"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "bc8e63982f5e48c3877e334e5a77082d"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "bc8e63982f5e48c3877e334e5a77082d"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bc8e63982f5e48c3877e334e5a77082d"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "7d6e1b5757784808b6ad0925cc3454f9"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "7d6e1b5757784808b6ad0925cc3454f9"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "7d6e1b5757784808b6ad0925cc3454f9"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "66547dd8071c4f0cbf828c34b04791d2"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "66547dd8071c4f0cbf828c34b04791d2"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "66547dd8071c4f0cbf828c34b04791d2"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "dbf0af0ec3434e1981146129e2234cdf"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "e3a3d9168b02465aaaed409d6730d756"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "4f69334f41e5426289d0fe866343fcfe"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:35:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:35:43+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.3d228febfb1f4203bd112519dca5e11f'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "82430e2ba69b462396b27a03ec0b63ab"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "82430e2ba69b462396b27a03ec0b63ab"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "82430e2ba69b462396b27a03ec0b63ab"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "58f530aca36c4d3082b0c1c833caa52e"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "58f530aca36c4d3082b0c1c833caa52e"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "58f530aca36c4d3082b0c1c833caa52e"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "9bf34b0e3b6647879f8da9e04148c3e6", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "76cf519d4938458c8df813702e02ea07"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "76cf519d4938458c8df813702e02ea07"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "76cf519d4938458c8df813702e02ea07"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6f2430fad750443095b7fa757136dba4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6f2430fad750443095b7fa757136dba4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6f2430fad750443095b7fa757136dba4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "1f383b0ee64542adb403dc51f024bfdf"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "1f383b0ee64542adb403dc51f024bfdf"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "1f383b0ee64542adb403dc51f024bfdf"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "6d0ca92a86e148fcbcf3833bf105b5b4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "6d0ca92a86e148fcbcf3833bf105b5b4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "6d0ca92a86e148fcbcf3833bf105b5b4"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "aa6fdaeca2b24d5d87f0d1abd72c39cb"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "aa6fdaeca2b24d5d87f0d1abd72c39cb"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "aa6fdaeca2b24d5d87f0d1abd72c39cb"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b7c2e556a68a4abe87dcb59f4bdee387"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "c81f53fc571f41c4bf9de94e9acd9ee5"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "31f9509a45bd4e32b955f687b16c28dd"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:21+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:36:27+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:38:43+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.58cbf6b4eebe430fa8781426b18843c0'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e245c9cc8ca342a9960cd24d7a904bd8"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e245c9cc8ca342a9960cd24d7a904bd8"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e245c9cc8ca342a9960cd24d7a904bd8"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "b4e84579668746f5b0191a954490721e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "b4e84579668746f5b0191a954490721e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b4e84579668746f5b0191a954490721e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "57f5a6b85e0740288cd8fae3b5e35bd5", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "cd582e51b907496a96271fc48556e2c2"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "cd582e51b907496a96271fc48556e2c2"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "cd582e51b907496a96271fc48556e2c2"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "c8309b7a7de14775a55b6dfb7144d991"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "c8309b7a7de14775a55b6dfb7144d991"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "c8309b7a7de14775a55b6dfb7144d991"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "da751d16bd9a4a879a7ab9dc94ff5655"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "da751d16bd9a4a879a7ab9dc94ff5655"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "da751d16bd9a4a879a7ab9dc94ff5655"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "2b3e51c427c844d28f0ff61033b4722e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "2b3e51c427c844d28f0ff61033b4722e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "2b3e51c427c844d28f0ff61033b4722e"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "80a0bba9b4c94219a5b9affde51761c5"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "80a0bba9b4c94219a5b9affde51761c5"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "80a0bba9b4c94219a5b9affde51761c5"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2834f437b78b4f168bd7415b4e68554f"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "43aeb7d326bd469390a9d026cace8692"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "66691c2cca7e4df68a78d1516a099d09"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:41+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:42+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:58:47+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:59:07+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:59:07+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:59:07+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:59:07+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T12:59:07+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "174691e3e7cf4435b5423bdd38e84b56"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "174691e3e7cf4435b5423bdd38e84b56"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "174691e3e7cf4435b5423bdd38e84b56"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9b635dc87c61445cbcd6e5180e72e0c9"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9b635dc87c61445cbcd6e5180e72e0c9"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9b635dc87c61445cbcd6e5180e72e0c9"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "3562af1ae3674de89556ed41e3438d70", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "88848cb6c11c4eb88e757667c0f9c490"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "88848cb6c11c4eb88e757667c0f9c490"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "88848cb6c11c4eb88e757667c0f9c490"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "4aee787a23b44d9bbce342b66a00f332"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "4aee787a23b44d9bbce342b66a00f332"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "4aee787a23b44d9bbce342b66a00f332"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "97926759c3494147a978305a6bfbc3b1"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "97926759c3494147a978305a6bfbc3b1"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "97926759c3494147a978305a6bfbc3b1"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "b68ee6d34a3f44ee9a60e70e8e01438a"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "b68ee6d34a3f44ee9a60e70e8e01438a"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "b68ee6d34a3f44ee9a60e70e8e01438a"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "93ccfc274dc94f18b1f10e45ceb4bcff"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "93ccfc274dc94f18b1f10e45ceb4bcff"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "93ccfc274dc94f18b1f10e45ceb4bcff"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bed9e8a0564c466697d47f16440be240"}
{"ts": "2025-09-09T13:03:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "dc07af4646384890b784f9c0a778c306"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "6720322c72f34cbf9b9eb66ea1f653e7"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:09+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:03:15+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.a50f064614694682b48ecbd20af8a7f1'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "7a831195c8e54dc2974c2bc544090f00"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "7a831195c8e54dc2974c2bc544090f00"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "7a831195c8e54dc2974c2bc544090f00"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "66c221d0327d49b795cd7146bbcc3d5b"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "66c221d0327d49b795cd7146bbcc3d5b"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "66c221d0327d49b795cd7146bbcc3d5b"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:12+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "f6ba77cc406649f0b0a5ccd3174a5648", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:43:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "cb1808bf62aa43c899a3371b1115a717"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "cb1808bf62aa43c899a3371b1115a717"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "cb1808bf62aa43c899a3371b1115a717"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a520cc72e5b3421db9bdd347b5d6db6e"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a520cc72e5b3421db9bdd347b5d6db6e"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a520cc72e5b3421db9bdd347b5d6db6e"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0c4ee7ffde1046f8b64d33b2afc6dc72"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0c4ee7ffde1046f8b64d33b2afc6dc72"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0c4ee7ffde1046f8b64d33b2afc6dc72"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "2c11039bec844345b69625fd354cf77b"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "2c11039bec844345b69625fd354cf77b"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "2c11039bec844345b69625fd354cf77b"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "f224032989e6406db9986b5e8860c5e1"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "f224032989e6406db9986b5e8860c5e1"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f224032989e6406db9986b5e8860c5e1"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fe1ffb11e6ea4e2693b6f8e7e726130e"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "b64aea167aa143f096e788f162f40606"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "b8265697292940f092083731107005fe"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:13+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "29f3635e06ee4244835b5061b98d085d"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "29f3635e06ee4244835b5061b98d085d"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "29f3635e06ee4244835b5061b98d085d"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e0f5289e89d74331894b01ce6340fb4e"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e0f5289e89d74331894b01ce6340fb4e"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e0f5289e89d74331894b01ce6340fb4e"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "bfa5de0f0f504c24a0274047ea615c92", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e7f67306488d429f80aedea370128da5"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e7f67306488d429f80aedea370128da5"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e7f67306488d429f80aedea370128da5"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "de012b2839e949769e9b7518c6ba43da"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "de012b2839e949769e9b7518c6ba43da"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "de012b2839e949769e9b7518c6ba43da"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "23ca7b258e26422d978e2f856dc1fa6f"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "23ca7b258e26422d978e2f856dc1fa6f"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "23ca7b258e26422d978e2f856dc1fa6f"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "62926385b2f84221a3562c7c4c407edf"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "62926385b2f84221a3562c7c4c407edf"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "62926385b2f84221a3562c7c4c407edf"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "fbece4c56b6743ab8727b3e6f687ab5c"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "fbece4c56b6743ab8727b3e6f687ab5c"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "fbece4c56b6743ab8727b3e6f687ab5c"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fd8a5a2356a942b7ac0fa24882e55eb5"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "cf509073fb2e47008cb51d70292d387e"}
{"ts": "2025-09-09T15:43:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "6ddf58af6dfb4abb8a9148e40467c53a"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:43:41+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "cb40d145f9f54ff7a4741646b027336e"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "cb40d145f9f54ff7a4741646b027336e"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "cb40d145f9f54ff7a4741646b027336e"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "5af5946f0772467baeeee203a1c2a77f"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "5af5946f0772467baeeee203a1c2a77f"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5af5946f0772467baeeee203a1c2a77f"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "bfeeae90a8594091a1163340beebe445", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a201bb25344e4ce1bd41607dfdc2e190"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a201bb25344e4ce1bd41607dfdc2e190"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a201bb25344e4ce1bd41607dfdc2e190"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "985e508414574e77a17eb3a10c9f0702"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "985e508414574e77a17eb3a10c9f0702"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "985e508414574e77a17eb3a10c9f0702"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "fc363c1ee2d9469cb408bc1ff76a7e05"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "fc363c1ee2d9469cb408bc1ff76a7e05"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fc363c1ee2d9469cb408bc1ff76a7e05"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "d639afd8304a496a965cb6b0c89b54c3"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "d639afd8304a496a965cb6b0c89b54c3"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "d639afd8304a496a965cb6b0c89b54c3"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "96f5ced0912b4b8890590925e53f477c"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "96f5ced0912b4b8890590925e53f477c"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "96f5ced0912b4b8890590925e53f477c"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f8e70b2bbd824789852088c507c2dca2"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "164ecac834054d1c8c5e704f9d400105"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "17274cc7a82640a78852b02aaed39b79"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:09+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"key": "value"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a8bb3deab13941eb82030b05422410ea"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a8bb3deab13941eb82030b05422410ea"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a8bb3deab13941eb82030b05422410ea"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "452d430a33994890b8d3cb1020c7f510"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "452d430a33994890b8d3cb1020c7f510"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "452d430a33994890b8d3cb1020c7f510"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "8817ec87a652433b9c3acfb608ba9d32", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6b766339258a4db585ea1a22247af7ab"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6b766339258a4db585ea1a22247af7ab"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6b766339258a4db585ea1a22247af7ab"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f0786c43e09e418ab312036d7baffe63"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f0786c43e09e418ab312036d7baffe63"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f0786c43e09e418ab312036d7baffe63"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "fb0b937fe6b040e4b6959362dffb2d9b"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "fb0b937fe6b040e4b6959362dffb2d9b"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fb0b937fe6b040e4b6959362dffb2d9b"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "f800ea61f391499fb4dee3b63b101d16"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "f800ea61f391499fb4dee3b63b101d16"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "f800ea61f391499fb4dee3b63b101d16"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "2c38f08020a842c08c22c7dde6b61fc8"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "2c38f08020a842c08c22c7dde6b61fc8"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "2c38f08020a842c08c22c7dde6b61fc8"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5b4dd122995b4732ab2f68f8b7df9c55"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "448cd323ab21429686c9580e7ed6fe18"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "b0be192eca72415a8fe710bf1a11cb70"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:39+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:44:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:44:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0815aad837294943899fc5a2d37319db"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0815aad837294943899fc5a2d37319db"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0815aad837294943899fc5a2d37319db"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "cf6d32f42e874ae3b8a716d72380b429"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "cf6d32f42e874ae3b8a716d72380b429"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "cf6d32f42e874ae3b8a716d72380b429"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:27+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "48758357727c4da4b6e454b0cb86909f", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:45:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "54414b12ae984af2a1c29eb7417c9abb"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "54414b12ae984af2a1c29eb7417c9abb"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "54414b12ae984af2a1c29eb7417c9abb"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "b98162b05284493b84bd8550a5e8ed29"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "b98162b05284493b84bd8550a5e8ed29"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b98162b05284493b84bd8550a5e8ed29"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "5608b7df0c734910898ce6c6b2a20e5e"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "5608b7df0c734910898ce6c6b2a20e5e"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5608b7df0c734910898ce6c6b2a20e5e"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "9679757be9b74119aee5ed6e4d361168"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "9679757be9b74119aee5ed6e4d361168"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "9679757be9b74119aee5ed6e4d361168"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "035366a5292843cea2b9ff1f6c9c91c9"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "035366a5292843cea2b9ff1f6c9c91c9"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "035366a5292843cea2b9ff1f6c9c91c9"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8259f218b85a4016a471bdd85afbf582"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "44f2e8f3964042dcad3b541bb7e56c60"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "c330e8ad62ff437f9c2320654396a89f"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound (fanout)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:45:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "2858130d6cc743438f58c26d69ee6b08"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "2858130d6cc743438f58c26d69ee6b08"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2858130d6cc743438f58c26d69ee6b08"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9f5b65a1cb754583bf6abf1752afdad6"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9f5b65a1cb754583bf6abf1752afdad6"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9f5b65a1cb754583bf6abf1752afdad6"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "c6c7774f15be45b1b70ff67e1619b20a", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "66d4d7023cd144bdb2065cf1d0ece6b5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "66d4d7023cd144bdb2065cf1d0ece6b5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "66d4d7023cd144bdb2065cf1d0ece6b5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "7b21788e1f76432289b8497d7e3fa7a0"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "7b21788e1f76432289b8497d7e3fa7a0"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "7b21788e1f76432289b8497d7e3fa7a0"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "8fce746b96b94fb99d4a07b6be2ecc18"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "8fce746b96b94fb99d4a07b6be2ecc18"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8fce746b96b94fb99d4a07b6be2ecc18"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "65ff7ef9eecc4743815c5f4b908cd201"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "65ff7ef9eecc4743815c5f4b908cd201"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "65ff7ef9eecc4743815c5f4b908cd201"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "998674a6ad9b4af3a4a2d8d6b9004ec5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "998674a6ad9b4af3a4a2d8d6b9004ec5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "998674a6ad9b4af3a4a2d8d6b9004ec5"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5ea6e2f8e1c84fe68ab19e624af2dd7d"}
{"ts": "2025-09-09T15:46:01+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "cf4dc863720f41d990a31b9a3a2d1e61"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "109e018038fd4742986314e2a4192f74"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:02+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:02+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "b6d1000375ee418fb43691f912eee72c"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "b6d1000375ee418fb43691f912eee72c"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b6d1000375ee418fb43691f912eee72c"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "d2f9f3f0a03e40acb9fbce3188325a28"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "d2f9f3f0a03e40acb9fbce3188325a28"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "d2f9f3f0a03e40acb9fbce3188325a28"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "d788389b8c0d420e9581b5b6b96d4489", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e8bbea804fb545e5b6f946a8e57177b0"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e8bbea804fb545e5b6f946a8e57177b0"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e8bbea804fb545e5b6f946a8e57177b0"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "228b68144429401487a7b82b8deae05d"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "228b68144429401487a7b82b8deae05d"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "228b68144429401487a7b82b8deae05d"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "30d311ce83964982addb59a9eac608f8"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "30d311ce83964982addb59a9eac608f8"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "30d311ce83964982addb59a9eac608f8"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "eeecd47612d94930aa88e206a5006e8e"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "eeecd47612d94930aa88e206a5006e8e"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "eeecd47612d94930aa88e206a5006e8e"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "63cddc1341584f408f7e42ae639eb915"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "63cddc1341584f408f7e42ae639eb915"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "63cddc1341584f408f7e42ae639eb915"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b670698d23bb4af2be0aa4868028c8f0"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "462beb623eb8471184cb8786ad2a1b22"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f2154bebc28e4a09be6d7a0eefba4e15"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:34+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:34+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:46:35+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "80ad243476f843e28c40a7498d4fd7dc"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "80ad243476f843e28c40a7498d4fd7dc"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "80ad243476f843e28c40a7498d4fd7dc"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "7d1b0cd8e0624889b7100856b0ebf9af"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "7d1b0cd8e0624889b7100856b0ebf9af"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "7d1b0cd8e0624889b7100856b0ebf9af"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "c80230a2527f43b9a840ab62ecbe16bb", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0ce2b7df44dd4021b01f6e372f77ab69"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0ce2b7df44dd4021b01f6e372f77ab69"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0ce2b7df44dd4021b01f6e372f77ab69"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f6ffbafa6eb9406ebaa6650ea35dbf84"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f6ffbafa6eb9406ebaa6650ea35dbf84"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f6ffbafa6eb9406ebaa6650ea35dbf84"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "2f85f3d00dd943fbb570d14544e77ae5"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "2f85f3d00dd943fbb570d14544e77ae5"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2f85f3d00dd943fbb570d14544e77ae5"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "17195266612a410e9e12a6482dd364d3"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "17195266612a410e9e12a6482dd364d3"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "17195266612a410e9e12a6482dd364d3"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "f341396d61f34b82aa2ffcc6937fdd06"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "f341396d61f34b82aa2ffcc6937fdd06"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f341396d61f34b82aa2ffcc6937fdd06"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6b3dc88ac5fe40d7b98dded4e44fdb47"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "870f1e9ef8b34ca1a9bb915df439c944"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "62903782270b4160a75050dbd525591f"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:10+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:47:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e5cfcefede5349d0bc0e62a29cb8f57f"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e5cfcefede5349d0bc0e62a29cb8f57f"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e5cfcefede5349d0bc0e62a29cb8f57f"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "d82e09110603425f82fbd561c2ec8711"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "d82e09110603425f82fbd561c2ec8711"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "d82e09110603425f82fbd561c2ec8711"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:39+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "07d97fd52a124197bf0b7a09ad563010", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:47:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "087c14ed9e43429f8f38df7283ea6e41"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "087c14ed9e43429f8f38df7283ea6e41"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "087c14ed9e43429f8f38df7283ea6e41"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "1e30888360774b79b309171d00a5695c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "1e30888360774b79b309171d00a5695c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "1e30888360774b79b309171d00a5695c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "66c916d300c34049b29a2e0cc1bc6a42"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "66c916d300c34049b29a2e0cc1bc6a42"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "66c916d300c34049b29a2e0cc1bc6a42"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "2fa8e31ab2e74746a99fbdc0ff1e6c1c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "2fa8e31ab2e74746a99fbdc0ff1e6c1c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "2fa8e31ab2e74746a99fbdc0ff1e6c1c"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "367c9c2625f9457ebf8d5272deaf9a62"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "367c9c2625f9457ebf8d5272deaf9a62"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "367c9c2625f9457ebf8d5272deaf9a62"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "27a7b359c87a40e1ad1f44f97033e900"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "548d7e34cdf24851aee7b2af3c415ee4"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "c0e32c940e4845aaac57fde9e90f4735"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:40+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:47:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "1ba5dce567524fa0b4f6ee3e5a2a1fb9"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "1ba5dce567524fa0b4f6ee3e5a2a1fb9"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "1ba5dce567524fa0b4f6ee3e5a2a1fb9"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "918b133fa30d4adeb15e601f151b1540"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "918b133fa30d4adeb15e601f151b1540"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "918b133fa30d4adeb15e601f151b1540"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "8d18b04d53684ee58b70035123063bad", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f711277a82234a3db091ce69845b2cd1"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f711277a82234a3db091ce69845b2cd1"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f711277a82234a3db091ce69845b2cd1"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "4e1aec970ba14918ab747ac80cdbd293"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "4e1aec970ba14918ab747ac80cdbd293"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "4e1aec970ba14918ab747ac80cdbd293"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ca8983d08a304a52ab6e2a1dfdd3750c"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ca8983d08a304a52ab6e2a1dfdd3750c"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ca8983d08a304a52ab6e2a1dfdd3750c"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "8152fb31973649f9a3f818cf8d56b542"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "8152fb31973649f9a3f818cf8d56b542"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "8152fb31973649f9a3f818cf8d56b542"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "e93b184c68e54eebb264bad672ba5b0d"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "e93b184c68e54eebb264bad672ba5b0d"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "e93b184c68e54eebb264bad672ba5b0d"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "48de8acd372b40d9a4fd1db1a8a447da"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "80c67bdc09844d2da5c6733ea5c1e7ee"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "2d381f8293b841b2b3b0630637ce2a37"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:48:29+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py\", line 2234, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:29+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\Users\\bpa\\Documents\\Documents_personnel_benjamin\\Cours\\mspr4\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\Users\\bpa\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T15:48:30+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "557019db621044ad96ff56f322f84075"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "557019db621044ad96ff56f322f84075"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "557019db621044ad96ff56f322f84075"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "767bee99bbe941f1b4b6787b4461f4ff"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "767bee99bbe941f1b4b6787b4461f4ff"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "767bee99bbe941f1b4b6787b4461f4ff"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:07+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "2b03e67f13c34c02a6ae58580b8ca88d", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "84f717e5954e42d2ab5bf80c7f57c909"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "84f717e5954e42d2ab5bf80c7f57c909"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "84f717e5954e42d2ab5bf80c7f57c909"}
{"ts": "2025-09-09T13:50:07+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "02f8e22cf0644408a0e0b427c264652b"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "02f8e22cf0644408a0e0b427c264652b"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "02f8e22cf0644408a0e0b427c264652b"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ba665d7ef1a149859a4faff03f60bd54"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ba665d7ef1a149859a4faff03f60bd54"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ba665d7ef1a149859a4faff03f60bd54"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "fee0ab4b5e004505b4928ceb87f04698"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "fee0ab4b5e004505b4928ceb87f04698"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "fee0ab4b5e004505b4928ceb87f04698"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "04161bc3252b4d929c3551668390c809"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "04161bc3252b4d929c3551668390c809"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "04161bc3252b4d929c3551668390c809"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "27134d8a833340c4b953fa30fe7ec50d"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "9b4ed14b39384ded9b5ec91aa10afe50"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "a7745c7c78ec49b491a852af8748c350"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:50:08+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:08+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:50:13+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:53:46+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.cff1d447372c4b3d8dd7f0e387881331'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a36c00caf65845f5aee0176b34b90103"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a36c00caf65845f5aee0176b34b90103"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a36c00caf65845f5aee0176b34b90103"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9ab81c64aa6a40fb9c6b675bb14d15d6"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9ab81c64aa6a40fb9c6b675bb14d15d6"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9ab81c64aa6a40fb9c6b675bb14d15d6"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "eec538ae07e94bdbb7b31cb04bcc9865", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "5f1706681bbb48f488f7b5a630facebc"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "5f1706681bbb48f488f7b5a630facebc"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5f1706681bbb48f488f7b5a630facebc"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "281c3993cad74873a5f86c7c3c9aa482"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "281c3993cad74873a5f86c7c3c9aa482"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "281c3993cad74873a5f86c7c3c9aa482"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "3255c20fda8648a7a3462ae00999c974"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "3255c20fda8648a7a3462ae00999c974"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "3255c20fda8648a7a3462ae00999c974"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "5c694834fcb24139a49fd2f0db96e9e4"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "5c694834fcb24139a49fd2f0db96e9e4"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "5c694834fcb24139a49fd2f0db96e9e4"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:25+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "02964febd2dd488e9d79f7d1333434b2"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "02964febd2dd488e9d79f7d1333434b2"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "02964febd2dd488e9d79f7d1333434b2"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ecccaa5b218a4518b6095ed881092712"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "f8470ab79922432294327096377cddaf"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "328c8e0625ac42a6802917c723566846"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:54:26+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:26+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:54:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6656a1e5f4504117969c1a07d63e8831"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6656a1e5f4504117969c1a07d63e8831"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6656a1e5f4504117969c1a07d63e8831"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "489cd1e9105d48648356a93dceb1ef23"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "489cd1e9105d48648356a93dceb1ef23"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "489cd1e9105d48648356a93dceb1ef23"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "d5fd7be9555f45cd94b9878d6563f5a9", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "52ecc8a59fcb4770a4085bace4af6542"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "52ecc8a59fcb4770a4085bace4af6542"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "52ecc8a59fcb4770a4085bace4af6542"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "175fef45c917465793ae16dec1f4a666"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "175fef45c917465793ae16dec1f4a666"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "175fef45c917465793ae16dec1f4a666"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "b3087995de884ee5b2f53137fcbb1eb3"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "b3087995de884ee5b2f53137fcbb1eb3"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b3087995de884ee5b2f53137fcbb1eb3"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "ba4aed4bbf114251bb1ce9b7af49c377"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "ba4aed4bbf114251bb1ce9b7af49c377"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "ba4aed4bbf114251bb1ce9b7af49c377"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "0a2eee5448c44e70af1bb5108e782c15"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "0a2eee5448c44e70af1bb5108e782c15"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "0a2eee5448c44e70af1bb5108e782c15"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "df540da635ce4305b781b34c751cd013"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "14f659062a6b4986b407c1e098d57c48"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "7907046f91bd4652aefcfbe3f759d42e"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Handler error rk=pattern1", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 125, in start_consumer\n    await handler(payload, rk)\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\ntest_rabbitmq.StopConsumer"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:56:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T13:57:04+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:05:56+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.c5422b0096c44283959030a11518690f'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "bd2ea35b34ed4ac3b249e5a39ab2241f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "bd2ea35b34ed4ac3b249e5a39ab2241f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bd2ea35b34ed4ac3b249e5a39ab2241f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "eb950cec38814aee9971e861086d899b"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "eb950cec38814aee9971e861086d899b"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "eb950cec38814aee9971e861086d899b"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "8e496c09c00e48c29887b218675e9be3", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "41b36d0927af49af8619c2ad08a0206a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "41b36d0927af49af8619c2ad08a0206a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "41b36d0927af49af8619c2ad08a0206a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "133af3e16e1244ebb6c04b87d396de0a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "133af3e16e1244ebb6c04b87d396de0a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "133af3e16e1244ebb6c04b87d396de0a"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6504ade85c4341ab8c2f03d43603f47f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6504ade85c4341ab8c2f03d43603f47f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6504ade85c4341ab8c2f03d43603f47f"}
{"ts": "2025-09-09T14:06:34+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "dedbc4a1a4ad48f6a13be2c6c42490aa"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "dedbc4a1a4ad48f6a13be2c6c42490aa"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "dedbc4a1a4ad48f6a13be2c6c42490aa"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "43e626fb954f45b4b90892dd5e874d13"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "43e626fb954f45b4b90892dd5e874d13"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "43e626fb954f45b4b90892dd5e874d13"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f45a18e3bd894edc9b945817f1ca4d10"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "182a891bd44e419282327ff58e899cf6"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "febb5c9af77643ee88c517899c3c21d2"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T14:06:35+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/app/app/infra/events/rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"/usr/local/lib/python3.11/unittest/mock.py\", line 2240, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/repositories/client.py\", line 19, in create_client\n    db.commit()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4487, in _flush\n    with util.safe_reraise():\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, version) VALUES (?, ?, ?, ?, ?) RETURNING id, created_at, updated_at]\n[parameters: ('Dup', 'dup@test.com', None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:35+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:06:40+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T14:07:03+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.f8868126926247f9a23b6fa4933dd2c3'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:40:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:40:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:40:44+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:40:44+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:40:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:40:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:40:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:40:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:40:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:48:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e9f36049c7954cddbb96acb136480415"}
{"ts": "2025-09-09T18:48:36+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.created, payload={'id': 1, 'name': 'Alice Dupont', 'email': 'alice@example.com'}", "service": "customer-api", "request_id": "e9f36049c7954cddbb96acb136480415"}
{"ts": "2025-09-09T18:48:36+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e9f36049c7954cddbb96acb136480415"}
{"ts": "2025-09-09T18:48:36+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e9f36049c7954cddbb96acb136480415"}
{"ts": "2025-09-09T18:49:13+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 1, 'sku': 'KAW-BRA-250', 'name': 'Café Brésil 250g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:49:28+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 2, 'sku': 'KAW-COL-1KG', 'name': 'Café Colombie 1kg'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:55:01+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "c608b470d63d4e4eb9c3974607b6cf10"}
{"ts": "2025-09-09T18:55:01+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.created, payload={'id': 2, 'name': 'Bob Martin', 'email': 'bob.martin@example.com'}", "service": "customer-api", "request_id": "c608b470d63d4e4eb9c3974607b6cf10"}
{"ts": "2025-09-09T18:55:01+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "c608b470d63d4e4eb9c3974607b6cf10"}
{"ts": "2025-09-09T18:55:01+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "c608b470d63d4e4eb9c3974607b6cf10"}
{"ts": "2025-09-09T18:55:10+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "c87b85e307ad4ca0acefb791f719be53"}
{"ts": "2025-09-09T18:55:10+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.created, payload={'id': 3, 'name': 'Claire Dubois', 'email': 'claire.dubois@example.com'}", "service": "customer-api", "request_id": "c87b85e307ad4ca0acefb791f719be53"}
{"ts": "2025-09-09T18:55:10+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "c87b85e307ad4ca0acefb791f719be53"}
{"ts": "2025-09-09T18:55:10+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "c87b85e307ad4ca0acefb791f719be53"}
{"ts": "2025-09-09T18:55:17+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "2baf74e0c2ee466b8b30e92f42d165af"}
{"ts": "2025-09-09T18:55:17+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.created, payload={'id': 4, 'name': 'David Morel', 'email': 'david.morel@example.com'}", "service": "customer-api", "request_id": "2baf74e0c2ee466b8b30e92f42d165af"}
{"ts": "2025-09-09T18:55:17+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "2baf74e0c2ee466b8b30e92f42d165af"}
{"ts": "2025-09-09T18:55:17+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2baf74e0c2ee466b8b30e92f42d165af"}
{"ts": "2025-09-09T18:55:25+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "70d40a44776f4a1f8c5246d808336b1f"}
{"ts": "2025-09-09T18:55:25+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.created, payload={'id': 5, 'name': 'Emma Leroy', 'email': 'emma.leroy@example.com'}", "service": "customer-api", "request_id": "70d40a44776f4a1f8c5246d808336b1f"}
{"ts": "2025-09-09T18:55:25+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "70d40a44776f4a1f8c5246d808336b1f"}
{"ts": "2025-09-09T18:55:25+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "70d40a44776f4a1f8c5246d808336b1f"}
{"ts": "2025-09-09T18:55:31+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "4eaafe2a00624b75bc0ef4149b93e142"}
{"ts": "2025-09-09T18:55:31+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.created, payload={'id': 6, 'name': 'François Petit', 'email': 'francois.petit@example.com'}", "service": "customer-api", "request_id": "4eaafe2a00624b75bc0ef4149b93e142"}
{"ts": "2025-09-09T18:55:31+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "4eaafe2a00624b75bc0ef4149b93e142"}
{"ts": "2025-09-09T18:55:31+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "4eaafe2a00624b75bc0ef4149b93e142"}
{"ts": "2025-09-09T18:55:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "7ba765e6f566498a937795c1126b5472"}
{"ts": "2025-09-09T18:55:36+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.created, payload={'id': 7, 'name': 'Hélène Garnier', 'email': 'helene.garnier@example.com'}", "service": "customer-api", "request_id": "7ba765e6f566498a937795c1126b5472"}
{"ts": "2025-09-09T18:55:36+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "7ba765e6f566498a937795c1126b5472"}
{"ts": "2025-09-09T18:55:36+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "7ba765e6f566498a937795c1126b5472"}
{"ts": "2025-09-09T18:55:43+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "570f5a21a04c4874965f52f9cf27c750"}
{"ts": "2025-09-09T18:55:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.created, payload={'id': 8, 'name': 'Isabelle Laurent', 'email': 'isabelle.laurent@example.com'}", "service": "customer-api", "request_id": "570f5a21a04c4874965f52f9cf27c750"}
{"ts": "2025-09-09T18:55:43+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "570f5a21a04c4874965f52f9cf27c750"}
{"ts": "2025-09-09T18:55:43+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "570f5a21a04c4874965f52f9cf27c750"}
{"ts": "2025-09-09T18:55:49+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "178fd24022534307be52ccec0ae6bfd9"}
{"ts": "2025-09-09T18:55:49+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.created, payload={'id': 9, 'name': 'Julien Bernard', 'email': 'julien.bernard@example.com'}", "service": "customer-api", "request_id": "178fd24022534307be52ccec0ae6bfd9"}
{"ts": "2025-09-09T18:55:49+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "178fd24022534307be52ccec0ae6bfd9"}
{"ts": "2025-09-09T18:55:49+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "178fd24022534307be52ccec0ae6bfd9"}
{"ts": "2025-09-09T18:55:56+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "bb705852c3bb46ee84e24c29b025c9a2"}
{"ts": "2025-09-09T18:55:56+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.created, payload={'id': 10, 'name': 'Karine Lefevre', 'email': 'karine.lefevre@example.com'}", "service": "customer-api", "request_id": "bb705852c3bb46ee84e24c29b025c9a2"}
{"ts": "2025-09-09T18:55:56+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "bb705852c3bb46ee84e24c29b025c9a2"}
{"ts": "2025-09-09T18:55:56+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bb705852c3bb46ee84e24c29b025c9a2"}
{"ts": "2025-09-09T18:56:14+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 3, 'sku': 'KAW-BRA-1KG', 'name': 'Café Brésil 1kg'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:56:23+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 4, 'sku': 'KAW-COL-250', 'name': 'Café Colombie 250g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:56:43+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 5, 'sku': 'KAW-ETH-250', 'name': 'Café Éthiopie 250g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:56:49+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 6, 'sku': 'KAW-ETH-1KG', 'name': 'Café Éthiopie 1kg'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:56:57+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 7, 'sku': 'KAW-KEN-250', 'name': 'Café Kenya 250g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:57:02+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 8, 'sku': 'KAW-KEN-1KG', 'name': 'Café Kenya 1kg'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:57:08+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 9, 'sku': 'KAW-ESP-500', 'name': 'Blend Espresso 500g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:57:13+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 10, 'sku': 'KAW-ESP-1KG', 'name': 'Blend Espresso 1kg'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:57:20+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 11, 'sku': 'KAW-DEC-250', 'name': 'Décaféiné 250g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:57:27+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 12, 'sku': 'KAW-DEC-1KG', 'name': 'Décaféiné 1kg'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:57:33+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 13, 'sku': 'KAW-CAP-16', 'name': 'Capsules Cappuccino x16'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:57:39+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 14, 'sku': 'KAW-ESP-16', 'name': 'Capsules Espresso x16'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:57:44+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 15, 'sku': 'KAW-LAT-16', 'name': 'Capsules Latte x16'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:57:49+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 16, 'sku': 'KAW-MOC-16', 'name': 'Capsules Mocha x16'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:57:56+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 17, 'sku': 'KAW-ICE-500', 'name': 'Café Glacé 500ml'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:58:01+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 18, 'sku': 'KAW-NIT-330', 'name': 'Nitro Cold Brew 330ml'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:58:05+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 19, 'sku': 'KAW-GOU-250', 'name': 'Café Gourmand 250g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T18:58:11+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.created: {'id': 20, 'sku': 'KAW-BIO-250', 'name': 'Café Bio 250g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:02:15+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9e097a00d0884cfa8ef66f8ec9f77700"}
{"ts": "2025-09-09T19:02:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.created, payload={'id': 11, 'name': 'Karine Luttin', 'email': 'karine.luttin@example.com'}", "service": "customer-api", "request_id": "9e097a00d0884cfa8ef66f8ec9f77700"}
{"ts": "2025-09-09T19:02:15+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9e097a00d0884cfa8ef66f8ec9f77700"}
{"ts": "2025-09-09T19:02:15+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9e097a00d0884cfa8ef66f8ec9f77700"}
{"ts": "2025-09-09T19:07:36+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "98eecf828bc843ccb1e074a9e94e1555"}
{"ts": "2025-09-09T19:07:36+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.updated, payload={'id': 1, 'name': 'Alice Dupont', 'email': 'alice@example.com'}", "service": "customer-api", "request_id": "98eecf828bc843ccb1e074a9e94e1555"}
{"ts": "2025-09-09T19:07:36+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "98eecf828bc843ccb1e074a9e94e1555"}
{"ts": "2025-09-09T19:07:36+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "98eecf828bc843ccb1e074a9e94e1555"}
{"ts": "2025-09-09T19:12:58+0000", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "890906d538fb4f97b0c7ecbbf1a2a761"}
{"ts": "2025-09-09T19:12:58+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=customer.deleted, payload={'id': 10}", "service": "customer-api", "request_id": "890906d538fb4f97b0c7ecbbf1a2a761"}
{"ts": "2025-09-09T19:12:58+0000", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "890906d538fb4f97b0c7ecbbf1a2a761"}
{"ts": "2025-09-09T19:12:58+0000", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "890906d538fb4f97b0c7ecbbf1a2a761"}
{"ts": "2025-09-09T19:17:50+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.updated: {'id': 1, 'sku': 'KAW-BRA-250', 'name': 'Café Brésil 250g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:18:29+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.deleted: {'id': 2, 'sku': 'KAW-COL-1KG'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:19:04+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received order.created: {'id': 1, 'customer_id': 1, 'status': 'pending', 'items': [{'product_id': 1, 'quantity': 3}, {'product_id': 2, 'quantity': 1}], 'created_at': '2025-09-09T19:19:04.389651'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:20:41+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received order.created: {'id': 2, 'customer_id': 1, 'status': 'pending', 'items': [{'product_id': 3, 'quantity': 10}, {'product_id': 5, 'quantity': 10}], 'created_at': '2025-09-09T19:20:41.717559'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:22:12+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received order.created: {'id': 3, 'customer_id': 1, 'status': 'pending', 'items': [{'product_id': 3, 'quantity': 10}, {'product_id': 5, 'quantity': 10}], 'created_at': '2025-09-09T19:22:12.060620'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:08+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:14+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:14+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:14+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:14+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:15+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:15+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:46:42+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received order.created: {'id': 4, 'customer_id': 1, 'status': 'pending', 'items': [{'product_id': 3, 'quantity': 10}, {'product_id': 4, 'quantity': 10}], 'created_at': '2025-09-09T19:46:42.104333'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:56:07+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received order.created: {'id': 5, 'customer_id': 1, 'status': 'pending', 'items': [{'product_id': 3, 'quantity': 10}, {'product_id': 4, 'quantity': 10}], 'created_at': '2025-09-09T19:56:07.731090'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T19:56:59+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received order.created: {'id': 6, 'customer_id': 1, 'status': 'pending', 'items': [{'product_id': 4, 'quantity': 10}, {'product_id': 5, 'quantity': 10}], 'created_at': '2025-09-09T19:56:59.644017'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:00:40+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received order.created: {'id': 7, 'customer_id': 1, 'status': 'pending', 'items': [{'product_id': 4, 'quantity': 10}, {'product_id': 5, 'quantity': 10}], 'created_at': '2025-09-09T20:00:40.790216'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:00:40+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.updated: {'id': 4, 'sku': 'KAW-COL-250', 'name': 'Café Colombie 250g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:00:40+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.updated: {'id': 5, 'sku': 'KAW-ETH-250', 'name': 'Café Éthiopie 250g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:48+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:48+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:48+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:48+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.9f4762ab8ca04408a3d9ac0106805c4f'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:54+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:54+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:54+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:54+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:54+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:54+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:54+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:54+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:46:54+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:38+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:38+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:38+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:38+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:38+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:38+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:38+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.d8de661aa4544c25b9089b4f494446f4'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:43+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:43+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:43+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:54:43+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:28+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:28+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:28+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.9053fe5b3a4d436085a454b3f004831f'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:32+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:32+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:32+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T20:55:32+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:37+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:37+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:37+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:37+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:37+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:37+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:37+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.26e6f5a583ef45b88b02c2a655f57a43'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:45+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:45+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:45+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:45+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:45+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:45+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:45+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:45+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:09:45+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:37+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:37+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:37+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:37+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:37+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:37+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:37+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.5d1f046e8d884939b710cfbcf8cb5598'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:45+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:45+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:45+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:45+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:45+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:45+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:45+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:45+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:28:45+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:33:02+0000", "level": "ERROR", "logger": "app.core.database", "msg": "db session rolled back due to exception", "service": "customer-api", "request_id": "1cba0401873c402aae81163b861924a6", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\npsycopg2.errors.UndefinedColumn: column clients.orders_count does not exist\nLINE 1: ...ted_at, clients.updated_at AS clients_updated_at, clients.or...\n                                                             ^\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/core/database.py\", line 54, in get_db\n    yield db\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column clients.orders_count does not exist\nLINE 1: ...ted_at, clients.updated_at AS clients_updated_at, clients.or...\n                                                             ^\n\n[SQL: SELECT clients.id AS clients_id, clients.name AS clients_name, clients.email AS clients_email, clients.company AS clients_company, clients.phone AS clients_phone, clients.created_at AS clients_created_at, clients.updated_at AS clients_updated_at, clients.orders_count AS clients_orders_count, clients.last_order_date AS clients_last_order_date, clients.version AS clients_version \nFROM clients ORDER BY clients.id \n LIMIT %(param_1)s OFFSET %(param_2)s]\n[parameters: {'param_1': 10, 'param_2': 0}]\n(Background on this error at: https://sqlalche.me/e/20/f405)"}
{"ts": "2025-09-09T21:33:02+0000", "level": "ERROR", "logger": "uvicorn.error", "msg": "Exception in ASGI application\n", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\npsycopg2.errors.UndefinedColumn: column clients.orders_count does not exist\nLINE 1: ...ted_at, clients.updated_at AS clients_updated_at, clients.or...\n                                                             ^\n\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/uvicorn/protocols/http/httptools_impl.py\", line 399, in run_asgi\n    result = await app(  # type: ignore[func-returns-value]\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py\", line 70, in __call__\n    return await self.app(scope, receive, send)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/applications.py\", line 1054, in __call__\n    await super().__call__(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/applications.py\", line 113, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 187, in __call__\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 165, in __call__\n    await self.app(scope, receive, _send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/main.py\", line 96, in metrics_middleware\n    response: Response = await call_next(request)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 185, in __call__\n    with collapse_excgroups():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_utils.py\", line 83, in collapse_excgroups\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 187, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/core/logging.py\", line 170, in access_log_middleware\n    response: Response = await call_next(request)\n                         ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 163, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/base.py\", line 149, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 715, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 735, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 288, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 76, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 62, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 51, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.11/site-packages/starlette/routing.py\", line 73, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 301, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/fastapi/routing.py\", line 214, in run_endpoint_function\n    return await run_in_threadpool(dependant.call, **values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/starlette/concurrency.py\", line 39, in run_in_threadpool\n    return await anyio.to_thread.run_sync(func, *args)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/to_thread.py\", line 56, in run_sync\n    return await get_async_backend().run_sync_in_worker_thread(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 2476, in run_sync_in_worker_thread\n    return await future\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/anyio/_backends/_asyncio.py\", line 967, in run\n    result = context.run(func, *args)\n             ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/api/routes.py\", line 69, in list_customers\n    rows = svc.list(\n           ^^^^^^^^^\n  File \"/app/app/services/client_service.py\", line 77, in list\n    return query.offset(skip).limit(limit).all()\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2673, in all\n    return self._iter().all()  # type: ignore\n           ^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/query.py\", line 2827, in _iter\n    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(\n                                                  ^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2362, in execute\n    return self._execute_internal(\n           ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 2247, in _execute_internal\n    result: Result[Any] = compile_state_cls.orm_execute_statement(\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/orm/context.py\", line 293, in orm_execute_statement\n    result = conn.execute(\n             ^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/usr/local/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column clients.orders_count does not exist\nLINE 1: ...ted_at, clients.updated_at AS clients_updated_at, clients.or...\n                                                             ^\n\n[SQL: SELECT clients.id AS clients_id, clients.name AS clients_name, clients.email AS clients_email, clients.company AS clients_company, clients.phone AS clients_phone, clients.created_at AS clients_created_at, clients.updated_at AS clients_updated_at, clients.orders_count AS clients_orders_count, clients.last_order_date AS clients_last_order_date, clients.version AS clients_version \nFROM clients ORDER BY clients.id \n LIMIT %(param_1)s OFFSET %(param_2)s]\n[parameters: {'param_1': 10, 'param_2': 0}]\n(Background on this error at: https://sqlalche.me/e/20/f405)"}
{"ts": "2025-09-09T21:52:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:28+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:28+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:28+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:28+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.2f2c63d97c744082b6c61542316b2b31'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:35+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:35+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:35+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:35+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:35+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:35+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T21:52:35+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:04+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:04+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:04+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:04+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.84da28f82043404e94d01491e13570ef'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:13+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:13+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:13+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to amqp://app:******@rabbitmq:5672/%2F closed. Reconnecting after 5 seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:13+0000", "level": "ERROR", "logger": "customer-api", "msg": "RabbitMQ startup failed", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 457, in connect\n    reader, writer = await asyncio.open_connection(\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/asyncio/streams.py\", line 48, in open_connection\n    transport, _ = await loop.create_connection(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"uvloop/loop.pyx\", line 2043, in create_connection\n  File \"uvloop/loop.pyx\", line 2020, in uvloop.loop.Loop.create_connection\nConnectionRefusedError: [Errno 111] Connection refused\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/main.py\", line 51, in lifespan\n    await rabbitmq.connect()\n  File \"/app/app/infra/events/rabbitmq.py\", line 40, in connect\n    self.connection = await aio_pika.connect_robust(self.url)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 340, in connect_robust\n    await connection.connect(timeout=timeout)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 186, in connect\n    await self.__fail_fast_future\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 141, in __connection_factory\n    await Connection.connect(self, self.__connect_timeout)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/connection.py\", line 118, in connect\n    self.transport = await UnderlayConnection.connect(\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/abc.py\", line 671, in connect\n    connection = await cls.make_connection(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/abc.py\", line 659, in make_connection\n    connection: aiormq.abc.AbstractConnection = await asyncio.wait_for(\n                                                ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/asyncio/tasks.py\", line 452, in wait_for\n    return await fut\n           ^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 920, in connect\n    await connection.connect(client_properties or {})\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/base.py\", line 164, in wrap\n    return await self.create_task(func(self, *args, **kwargs))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/abc.py\", line 44, in __inner\n    return await self.task\n           ^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 464, in connect\n    raise AMQPConnectionError(*e.args) from e\naiormq.exceptions.AMQPConnectionError: [Errno 111] Connection refused"}
{"ts": "2025-09-09T22:03:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:03:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:09:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:09:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:09:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:09:59+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:10:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:10:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:10:08+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:10:08+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:10:08+0000", "level": "INFO", "logger": "aio_pika.robust_connection", "msg": "Connection to amqp://app:******@rabbitmq:5672/%2F closed. Reconnecting after 5 seconds.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:10:08+0000", "level": "ERROR", "logger": "customer-api", "msg": "RabbitMQ startup failed", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 457, in connect\n    reader, writer = await asyncio.open_connection(\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/asyncio/streams.py\", line 48, in open_connection\n    transport, _ = await loop.create_connection(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"uvloop/loop.pyx\", line 2043, in create_connection\n  File \"uvloop/loop.pyx\", line 2020, in uvloop.loop.Loop.create_connection\nConnectionRefusedError: [Errno 111] Connection refused\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/app/app/main.py\", line 51, in lifespan\n    await rabbitmq.connect()\n  File \"/app/app/infra/events/rabbitmq.py\", line 40, in connect\n    self.connection = await aio_pika.connect_robust(self.url)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 340, in connect_robust\n    await connection.connect(timeout=timeout)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 186, in connect\n    await self.__fail_fast_future\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/robust_connection.py\", line 141, in __connection_factory\n    await Connection.connect(self, self.__connect_timeout)\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/connection.py\", line 118, in connect\n    self.transport = await UnderlayConnection.connect(\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/abc.py\", line 671, in connect\n    connection = await cls.make_connection(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aio_pika/abc.py\", line 659, in make_connection\n    connection: aiormq.abc.AbstractConnection = await asyncio.wait_for(\n                                                ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/asyncio/tasks.py\", line 452, in wait_for\n    return await fut\n           ^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 920, in connect\n    await connection.connect(client_properties or {})\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/base.py\", line 164, in wrap\n    return await self.create_task(func(self, *args, **kwargs))\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/abc.py\", line 44, in __inner\n    return await self.task\n           ^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.11/site-packages/aiormq/connection.py\", line 464, in connect\n    raise AMQPConnectionError(*e.args) from e\naiormq.exceptions.AMQPConnectionError: [Errno 111] Connection refused"}
{"ts": "2025-09-09T22:10:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-09T22:10:08+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:01+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:01+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:01+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:01+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:10+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:10+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:10+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:10+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:10+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:25:10+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:39+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:39+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:39+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:39+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.3db4f6bc21b4481d92e88c55f27da00b'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:44+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:44+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:44+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:29:44+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:06+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Shutting down", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:06+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application shutdown.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:07+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:07+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:07+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application shutdown complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:07+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Finished server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:07+0000", "level": "INFO", "logger": "aio_pika.queue", "msg": "<RobustQueueIterator: queue='q-customer' ctag='ctag2.b1363c941ee14c9c98ada17434838e0d'> closing with timeout 5 seconds", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Started server process [1]", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Waiting for application startup.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:13+0000", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:13+0000", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:13+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Application startup complete.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:13+0000", "level": "INFO", "logger": "uvicorn.error", "msg": "Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:13+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern product.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T12:41:13+0000", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue q-customer bound to pattern order.#", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T14:02:19+0000", "level": "WARNING", "logger": "app.security.security", "msg": "JWT invalide (signature/iss/exp)", "service": "customer-api", "request_id": "477276b7d12543448d6c17a177c12660"}
{"ts": "2025-09-10T14:17:45+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received order.created: {'id': 8, 'customer_id': 1, 'status': 'pending', 'items': [{'product_id': 3, 'quantity': 10}, {'product_id': 4, 'quantity': 10}], 'created_at': '2025-09-10T14:17:44.827391'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T14:17:45+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.updated: {'id': 3, 'sku': 'KAW-BRA-1KG', 'name': 'Café Brésil 1kg'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T14:17:45+0000", "level": "INFO", "logger": "customer-api", "msg": "[customer-api] received product.updated: {'id': 4, 'sku': 'KAW-COL-250', 'name': 'Café Colombie 250g'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "daf5f790559d473bbdaa6a97a76c1660"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "daf5f790559d473bbdaa6a97a76c1660"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "daf5f790559d473bbdaa6a97a76c1660"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "4bf65c5bab4e452f89f2209cc9575b9f"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "4bf65c5bab4e452f89f2209cc9575b9f"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "4bf65c5bab4e452f89f2209cc9575b9f"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "7bbb1e921bd74f75b8e49cffc8fa42b4", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "5d8d36c16ab44fb3b67a7145b27a1a9a"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "5d8d36c16ab44fb3b67a7145b27a1a9a"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5d8d36c16ab44fb3b67a7145b27a1a9a"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "954446e92f5f4d06a70347219d3c86a7"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "954446e92f5f4d06a70347219d3c86a7"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "954446e92f5f4d06a70347219d3c86a7"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "de8a115c651b463eba9ff2bd9da4e853"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "de8a115c651b463eba9ff2bd9da4e853"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "de8a115c651b463eba9ff2bd9da4e853"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "2ddaa2139e5c4df38af98733d41dce8d"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "2ddaa2139e5c4df38af98733d41dce8d"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "2ddaa2139e5c4df38af98733d41dce8d"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "38c461c3f13b4bb480248b4c3fcc2504"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "38c461c3f13b4bb480248b4c3fcc2504"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "38c461c3f13b4bb480248b4c3fcc2504"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "89127931939d449783fa4901afded561"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "70983dc10b3041b19a78c487e69a288f"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "393ed0e647a7456f91c537ac03d57aa5"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\unittest\\mock.py\", line 2282, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-10T20:50:20+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\unittest\\mock.py\", line 2282, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\unittest\\mock.py\", line 2282, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T20:50:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "691d642385ca418e8c337fd44bf04715"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "691d642385ca418e8c337fd44bf04715"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "691d642385ca418e8c337fd44bf04715"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "d83a707fad724d3bb88af7cfdb2d458c"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "d83a707fad724d3bb88af7cfdb2d458c"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "d83a707fad724d3bb88af7cfdb2d458c"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "14fc4f685991474db743a348a9228305", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f8eb9cb40003472b9a3062c46007cad1"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f8eb9cb40003472b9a3062c46007cad1"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f8eb9cb40003472b9a3062c46007cad1"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "74171e696da64fbe817c6b0986f91880"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "74171e696da64fbe817c6b0986f91880"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "74171e696da64fbe817c6b0986f91880"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6dfa0d0389c840348999df02222b8e2b"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6dfa0d0389c840348999df02222b8e2b"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6dfa0d0389c840348999df02222b8e2b"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "2002ee926af848abb00ce562d6d26e54"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "2002ee926af848abb00ce562d6d26e54"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "2002ee926af848abb00ce562d6d26e54"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "4b772466b44f4cc9980cc3016ae0e9fd"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "4b772466b44f4cc9980cc3016ae0e9fd"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "4b772466b44f4cc9980cc3016ae0e9fd"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "16eafdac6b7147fb84828d585734222e"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "d03a09cd59634563952a2d6f0a1aecc1"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "749f558672ff4a90a212e059f78d201a"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connected. Exchange 'events' (topic) declared.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ channel closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "RabbitMQ connection closed.", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ channel.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 54, in disconnect\n    await self.channel.close()\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\unittest\\mock.py\", line 2282, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-10T21:17:36+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to close RabbitMQ connection.", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 61, in disconnect\n    await self.connection.close()\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\unittest\\mock.py\", line 2282, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Published rk=test.key, payload={'key': 'value'}", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Cannot publish: exchange is not available (connect() not called).", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "ERROR", "logger": "app.infra.events.rabbitmq", "msg": "Failed to publish rk=some.key", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\infra\\events\\rabbitmq.py\", line 74, in publish_message\n    await self.exchange.publish(\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\unittest\\mock.py\", line 2282, in _execute_mock_call\n    raise effect\nException: Test Exception"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.infra.events.rabbitmq", "msg": "Queue test_queue bound to pattern pattern2", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:17:36+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "fc36d58ee5934505a9be845ffa784119"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "fc36d58ee5934505a9be845ffa784119"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fc36d58ee5934505a9be845ffa784119"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a116aba8016e402f96e52bd9fc63aa4b"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a116aba8016e402f96e52bd9fc63aa4b"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a116aba8016e402f96e52bd9fc63aa4b"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "879c431a35d749da978100ce4600c042", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "5d78be4a51ec401d87e27d730ed14c57"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "5d78be4a51ec401d87e27d730ed14c57"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5d78be4a51ec401d87e27d730ed14c57"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "b143fd2d1d0e4ff0ba871e7f83416abd"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "b143fd2d1d0e4ff0ba871e7f83416abd"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b143fd2d1d0e4ff0ba871e7f83416abd"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "67728282102e4520bb410bda2e216c94"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "67728282102e4520bb410bda2e216c94"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "67728282102e4520bb410bda2e216c94"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "0dec07e0abec49a9a7cb68e241e8834d"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "0dec07e0abec49a9a7cb68e241e8834d"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "0dec07e0abec49a9a7cb68e241e8834d"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "6da8063883254766a536d1caf0fff1d9"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "6da8063883254766a536d1caf0fff1d9"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "6da8063883254766a536d1caf0fff1d9"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8c015d1f38734a12a840f28f44a75d66"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "6fe2b81bebc64889916a3661c0518389"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "87f05f8f53114c3084247604d8938ae7"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:37+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "4cbcb5c428ac4e4b899b889d8b083fe2"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "7adaa88e8c52469db41baba2e47d3a43"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "60e43bbef1974cd3a5b19a8ae6430d40"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:20:38+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "bf947e89b2ea45fdbb3c06e6dea5f4ce"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "bf947e89b2ea45fdbb3c06e6dea5f4ce"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bf947e89b2ea45fdbb3c06e6dea5f4ce"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "439bedbcc10f4d13af0da7329efe2ed6"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "439bedbcc10f4d13af0da7329efe2ed6"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "439bedbcc10f4d13af0da7329efe2ed6"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "68920edce0984f8b91ac4a40fb0679e9", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "d2d3da6d41f54addb5a7752e7be0306f"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "d2d3da6d41f54addb5a7752e7be0306f"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "d2d3da6d41f54addb5a7752e7be0306f"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "7b1d10189d744c80b9a0326de870110c"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "7b1d10189d744c80b9a0326de870110c"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "7b1d10189d744c80b9a0326de870110c"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "2b5f14d4fb6e40ecaa4bceaf9e3e9115"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "2b5f14d4fb6e40ecaa4bceaf9e3e9115"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2b5f14d4fb6e40ecaa4bceaf9e3e9115"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "4ed4a3ba5add43f78c5dd7459369cb5e"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "4ed4a3ba5add43f78c5dd7459369cb5e"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "4ed4a3ba5add43f78c5dd7459369cb5e"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "3457adbc005a45b3bf39045af5639e3a"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "3457adbc005a45b3bf39045af5639e3a"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "3457adbc005a45b3bf39045af5639e3a"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:45+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bdc470aa4f2d4ca88f22523fa53f22aa"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "e2300a93c5354054aa249fc6eaed5b0f"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "c56b7e54703e43649dea1b31d211d1a5"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fba821f87f1444af862b939fbd66a5cf"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "6bd8760a879c4d549d44689282da16e2"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "a23a62a9715c46e5b5f18e6a5f038cec"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:21:46+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 70, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 70, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:46+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:47+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:21:47+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:11+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "baf69d0c973b49b48cc3f08e7f873fd7"}
{"ts": "2025-09-10T21:23:11+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "baf69d0c973b49b48cc3f08e7f873fd7"}
{"ts": "2025-09-10T21:23:11+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "baf69d0c973b49b48cc3f08e7f873fd7"}
{"ts": "2025-09-10T21:23:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:11+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "25cf751cf79f4611bf9b3b42d9c8e595"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "25cf751cf79f4611bf9b3b42d9c8e595"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "25cf751cf79f4611bf9b3b42d9c8e595"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "597b380a8b654fc8ab7622123a800383", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "723e2ca5be91409fa035d0dde14c543b"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "723e2ca5be91409fa035d0dde14c543b"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "723e2ca5be91409fa035d0dde14c543b"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "16f32d6d681d4482a530b4351525d102"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "16f32d6d681d4482a530b4351525d102"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "16f32d6d681d4482a530b4351525d102"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "3eb7d501c6cf46ba818799d515d8e65a"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "3eb7d501c6cf46ba818799d515d8e65a"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "3eb7d501c6cf46ba818799d515d8e65a"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "0d3a069f01af4f1e83544e1e0255048f"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "0d3a069f01af4f1e83544e1e0255048f"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "0d3a069f01af4f1e83544e1e0255048f"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "2ea0c73023b8474e9ed753be839d3c5e"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "2ea0c73023b8474e9ed753be839d3c5e"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "2ea0c73023b8474e9ed753be839d3c5e"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9c7cefd587a54ee585c348edde5177c5"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "004e530930d343cca3bcb0ecae646098"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "9086a020fe8c44b79eddbb8042980471"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9af361c47fdf4f148168f4ed75338f4a"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "d5624603ab294977baf29f265b492ebe"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "df4ec779d2024fff915b05663c4411da"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:23:12+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:23:12+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e95c9c6f096e4436b59d422bffbbbd24"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e95c9c6f096e4436b59d422bffbbbd24"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e95c9c6f096e4436b59d422bffbbbd24"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "c2c60baebb734dd4b6cbf3a4f0e5d7ab"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "c2c60baebb734dd4b6cbf3a4f0e5d7ab"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "c2c60baebb734dd4b6cbf3a4f0e5d7ab"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "4c4b51a0cc1a45a895e4ea2cd5cd6222", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "fb612ec2fe9a41298719c0d61c1bfc7e"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "fb612ec2fe9a41298719c0d61c1bfc7e"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fb612ec2fe9a41298719c0d61c1bfc7e"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ec537e7e354d4c938531cbc680000ab0"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ec537e7e354d4c938531cbc680000ab0"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ec537e7e354d4c938531cbc680000ab0"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a3ef0cd743c74b6ca3584310252a1529"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a3ef0cd743c74b6ca3584310252a1529"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a3ef0cd743c74b6ca3584310252a1529"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "a8cb522b438046f18474240aba3bb50f"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "a8cb522b438046f18474240aba3bb50f"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "a8cb522b438046f18474240aba3bb50f"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "1b843a61b82d43a5913746ea4d339581"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "1b843a61b82d43a5913746ea4d339581"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "1b843a61b82d43a5913746ea4d339581"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9f5ff7354cf74a12963b64aee12ed3c0"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "f8eef48836804082ba99c7a4b321d73f"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "25e4affa1e7443c3b9ef59efa04a9b2d"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5f95af1ee9c04016b1dc7e823b5e7028"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "16522b1103a548a18737028a39f50ab3"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "2f00dff1f5ee4315962c17169ae59721"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:24:40+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:24:40+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "477508d4a4504fc28534c6c79483fcae"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "477508d4a4504fc28534c6c79483fcae"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "477508d4a4504fc28534c6c79483fcae"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "fe7b0e1d083a4149a30c69135b7b9038"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "fe7b0e1d083a4149a30c69135b7b9038"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fe7b0e1d083a4149a30c69135b7b9038"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "4f05dddc9f4044f1aa4051d102a8603e", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "055fbfb97b7f4d64970458cc82b5494a"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "055fbfb97b7f4d64970458cc82b5494a"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "055fbfb97b7f4d64970458cc82b5494a"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "998e26b20bfc4af1a2cd24864a8a8867"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "998e26b20bfc4af1a2cd24864a8a8867"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "998e26b20bfc4af1a2cd24864a8a8867"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "eddd1ca9b13a410abf0c277f2c6f6671"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "eddd1ca9b13a410abf0c277f2c6f6671"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "eddd1ca9b13a410abf0c277f2c6f6671"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "d995903fbaad4f63bbe6d0ded998d6f4"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "d995903fbaad4f63bbe6d0ded998d6f4"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "d995903fbaad4f63bbe6d0ded998d6f4"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "d31d1e553485463dabe091b9f68ad382"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "d31d1e553485463dabe091b9f68ad382"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "d31d1e553485463dabe091b9f68ad382"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9b2b2c1307654124958727bd629c8985"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "57c7e96a14074d73a61a0f40353f53ac"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f4d14ec9b6734c05bb8befaeeb7e2c58"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "83027d09d71543ff8455c4d94d65f574"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "beb176f26f054fe6b9355cc0c1d29bef"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "7555a9b7143b449d8a4d3834bb9677be"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:26:07+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:07+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:08+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:08+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:08+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "8ac03ebe42764289a6c0ca06df75eb01"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "8ac03ebe42764289a6c0ca06df75eb01"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8ac03ebe42764289a6c0ca06df75eb01"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6059a66f30f342bcbfc747532b9283e1"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6059a66f30f342bcbfc747532b9283e1"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6059a66f30f342bcbfc747532b9283e1"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "18eb6d7b39ba4948abf7f50afd26afec", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "491d7f3f85e44634bed49789b1e80f35"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "491d7f3f85e44634bed49789b1e80f35"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "491d7f3f85e44634bed49789b1e80f35"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6eecf7f9fb6943e4b387476cfad512b6"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6eecf7f9fb6943e4b387476cfad512b6"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6eecf7f9fb6943e4b387476cfad512b6"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "a33482eff0374daa85f0c8e094d41eab"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "a33482eff0374daa85f0c8e094d41eab"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a33482eff0374daa85f0c8e094d41eab"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "00655dc0db2e425ab60351504dcd84ff"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "00655dc0db2e425ab60351504dcd84ff"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "00655dc0db2e425ab60351504dcd84ff"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "e9b2357eb03347dc82acb6383bab11ce"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "e9b2357eb03347dc82acb6383bab11ce"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "e9b2357eb03347dc82acb6383bab11ce"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "a7115e3daa7e490499619284484ca803"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "9dfdc06cf1374c86bd4d8a6203410c2f"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "f0339a9a606a4f8bbffef1226ad7fdd8"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "13d623b46217445f8c4b18fdc4f85d35"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "5ec36c882c2546cb9dc90e480d0498f2"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "a167aa29478a428da864edf9e66e0fe9"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:26:55+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:26:55+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ab1e894721754e85ab76f03aae7351e6"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ab1e894721754e85ab76f03aae7351e6"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ab1e894721754e85ab76f03aae7351e6"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "17e8dbd352194468ac59c43c4f69b1e4"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "17e8dbd352194468ac59c43c4f69b1e4"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "17e8dbd352194468ac59c43c4f69b1e4"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "f25c843660694e8ea026f5a33684fafc", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "045e77fbbef04a3094f5e195c3fe4219"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "045e77fbbef04a3094f5e195c3fe4219"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "045e77fbbef04a3094f5e195c3fe4219"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "21e5f379acf1435bbffcf96fa32996f4"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "21e5f379acf1435bbffcf96fa32996f4"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "21e5f379acf1435bbffcf96fa32996f4"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "823a2842e8e540559e774c2ceeb665af"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "823a2842e8e540559e774c2ceeb665af"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "823a2842e8e540559e774c2ceeb665af"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "3085147b1f2649899a729801bb73f08b"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "3085147b1f2649899a729801bb73f08b"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "3085147b1f2649899a729801bb73f08b"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "92dbe17054ce4000be4c662d165d0b95"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "92dbe17054ce4000be4c662d165d0b95"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "92dbe17054ce4000be4c662d165d0b95"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "acf30ce2d8534b90b62e9c52e976c3c3"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "0245224bcf2d414d8ee909970ece7ecf"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "1520dc82aa4f4f8db27d529ba2a54f3f"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "222ff72ed3c4402985b0ca7674f54271"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "5ee793da4a024875bb6817f8ea30dfa0"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "22d0842168ff479394cfb51dd6fc9c76"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:28:20+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:28:20+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "b55187fc06854628ac09e9814cefa194"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "b55187fc06854628ac09e9814cefa194"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b55187fc06854628ac09e9814cefa194"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "8ddd35e3df404e19b4b2081134710e13"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "8ddd35e3df404e19b4b2081134710e13"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8ddd35e3df404e19b4b2081134710e13"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:38+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "5c0e9e0b821244c5985e878248b28938", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6a9e7bee8a4f4ad1b5fae153ab730007"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6a9e7bee8a4f4ad1b5fae153ab730007"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6a9e7bee8a4f4ad1b5fae153ab730007"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "4f251809169f4a0b9c8da97c5aa9f102"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "4f251809169f4a0b9c8da97c5aa9f102"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "4f251809169f4a0b9c8da97c5aa9f102"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ad221f4f59f5456f845c273de6bcfa68"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ad221f4f59f5456f845c273de6bcfa68"}
{"ts": "2025-09-10T21:32:38+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ad221f4f59f5456f845c273de6bcfa68"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "66627902fbbd4688a530c29ba01c681c"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "66627902fbbd4688a530c29ba01c681c"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "66627902fbbd4688a530c29ba01c681c"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "74ee7986d19947f08fe28502db031cc0"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "74ee7986d19947f08fe28502db031cc0"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "74ee7986d19947f08fe28502db031cc0"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "b2ccefefe62a4bfaaa86d3fa61eb919a"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "e0cef1f137524b36a51ad26530f19415"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "a60124c0f97a486e8d259e308d4ae62c"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "cd60eba7bacf41f2898bceb2687087ac"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "9a1712eb95af47d49e42fbfbc515d698"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "6d47bdd9361a4abf9de921b093d737d4"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:32:39+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:32:39+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "8177a6584b594248856211e7fa40dc60"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "8177a6584b594248856211e7fa40dc60"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8177a6584b594248856211e7fa40dc60"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "d892bdcf56b341fa98df03ad5e68cb09"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "d892bdcf56b341fa98df03ad5e68cb09"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "d892bdcf56b341fa98df03ad5e68cb09"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "e5b6ec8c5da7448bb7bb3a7c1224f997", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "bf63b7e35b5b46d88f85460bdba261f6"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "bf63b7e35b5b46d88f85460bdba261f6"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "bf63b7e35b5b46d88f85460bdba261f6"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "003d0c3789374e25b9f489c284023cfc"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "003d0c3789374e25b9f489c284023cfc"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "003d0c3789374e25b9f489c284023cfc"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "58aa48c9596f48278f8fb6758abc672d"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "58aa48c9596f48278f8fb6758abc672d"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "58aa48c9596f48278f8fb6758abc672d"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "29a9aaac965642dd9c0ee8b60b67e9cc"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "29a9aaac965642dd9c0ee8b60b67e9cc"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "29a9aaac965642dd9c0ee8b60b67e9cc"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "690b20e60d0649558dac768f07f30cea"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "690b20e60d0649558dac768f07f30cea"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "690b20e60d0649558dac768f07f30cea"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fa3be98a62d245afa618bd94320493da"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "0c1357a37c4646918b4cbd2060610b18"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "3e70d507aa364cc68ba88883f749cdbc"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "4a36f330957c4814a23e321a3854ceb5"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "d93abcd38a224846b20622f075c4f47f"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "3d7afafd40634897bcd069165b574544"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:27+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:34:28+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:34:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:28+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:34:28+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6d6e1657e68347a78d3dd927d2475366"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6d6e1657e68347a78d3dd927d2475366"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6d6e1657e68347a78d3dd927d2475366"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "930e7d130c5041388554dabeec39f55b"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "930e7d130c5041388554dabeec39f55b"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "930e7d130c5041388554dabeec39f55b"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:49+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "9596c85b43fb494c981c255006ab1282", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "1441e63be10a4f4aa088ffc0a3b5c07b"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "1441e63be10a4f4aa088ffc0a3b5c07b"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "1441e63be10a4f4aa088ffc0a3b5c07b"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ac5a15dbe81141dfb00056f376d649b5"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ac5a15dbe81141dfb00056f376d649b5"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ac5a15dbe81141dfb00056f376d649b5"}
{"ts": "2025-09-10T21:35:49+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "99a6bda6829845b09c644f540b8969b0"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "99a6bda6829845b09c644f540b8969b0"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "99a6bda6829845b09c644f540b8969b0"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "319294a5028e45e0849f3c9c232113f7"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "319294a5028e45e0849f3c9c232113f7"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "319294a5028e45e0849f3c9c232113f7"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "62d2c1a604d6472b82546e3d100c36af"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "62d2c1a604d6472b82546e3d100c36af"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "62d2c1a604d6472b82546e3d100c36af"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "847a275a93534139a95048cb19c76034"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "cd51d847b0314bbfbd15b4f7f1c558bf"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "90e962bf136a4e23b57c64295a12f8b2"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6ca1e4a05d4a4ff59f6ccecc5b99798a"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "c964bab7f07d453ab71bd8f03c76768c"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "7eb1dc5f3df949b9ab376c008a398ae5"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:35:50+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:35:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:03+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "379fc3bce008415ebaf030d6ad94d9b5"}
{"ts": "2025-09-10T21:38:03+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "379fc3bce008415ebaf030d6ad94d9b5"}
{"ts": "2025-09-10T21:38:03+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "379fc3bce008415ebaf030d6ad94d9b5"}
{"ts": "2025-09-10T21:38:03+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:03+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:03+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "79197daa7f55453fa6ab5d4150227b02"}
{"ts": "2025-09-10T21:38:03+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "79197daa7f55453fa6ab5d4150227b02"}
{"ts": "2025-09-10T21:38:03+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "79197daa7f55453fa6ab5d4150227b02"}
{"ts": "2025-09-10T21:38:03+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:03+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "173b14691cb243ca87a7ad46736e4b3f", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:38:03+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "fa6eb17618254da9a097db61de5b1463"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "fa6eb17618254da9a097db61de5b1463"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "fa6eb17618254da9a097db61de5b1463"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "d6681aba6af9492d902c95733d700e1b"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "d6681aba6af9492d902c95733d700e1b"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "d6681aba6af9492d902c95733d700e1b"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "914cf2b5a58b4510affe10829a9ed346"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "914cf2b5a58b4510affe10829a9ed346"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "914cf2b5a58b4510affe10829a9ed346"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "b7f849c4647b494fa42f9e1b8458fc80"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "b7f849c4647b494fa42f9e1b8458fc80"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "b7f849c4647b494fa42f9e1b8458fc80"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "df129b7456b64e1e8c8c12123d7ae125"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "df129b7456b64e1e8c8c12123d7ae125"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "df129b7456b64e1e8c8c12123d7ae125"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "c0123bd9926d410db79981430deed41c"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "96515c5357d240be8471b362867d7b44"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "bb4907ab2f574cd0ae0f82aaa69f7e45"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "84e83e04d1f84770a6b4c57d81f7f919"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "56362a32f8224c03b9d00c88d930ffa5"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "0f0fcb6254aa41de918f33be4dbf1cc2"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:38:04+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "WARNING", "logger": "app.security.security", "msg": "JWT invalide (signature/iss/exp)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:04+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "1d9fa1d504d94ab7a94c6b175ac78606"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "1d9fa1d504d94ab7a94c6b175ac78606"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "1d9fa1d504d94ab7a94c6b175ac78606"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "def2606b2cac4b9084d2b785a9b65aa4"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "def2606b2cac4b9084d2b785a9b65aa4"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "def2606b2cac4b9084d2b785a9b65aa4"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "930450b337f3498995f01c2022d50d95", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "e60e762dc53a4c5ba0af1a8f73c63204"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "e60e762dc53a4c5ba0af1a8f73c63204"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "e60e762dc53a4c5ba0af1a8f73c63204"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "3a4ebd0da7c84bc38510474aadf4a9a0"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "3a4ebd0da7c84bc38510474aadf4a9a0"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "3a4ebd0da7c84bc38510474aadf4a9a0"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "5de5f169a9e8457b80d308786cc671a9"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "5de5f169a9e8457b80d308786cc671a9"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "5de5f169a9e8457b80d308786cc671a9"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "fd398659546a4f8e96546b57277bb959"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "fd398659546a4f8e96546b57277bb959"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "fd398659546a4f8e96546b57277bb959"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "8c93427a0ff847fe898864c53681cbf8"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "8c93427a0ff847fe898864c53681cbf8"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "8c93427a0ff847fe898864c53681cbf8"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6a5e273100eb4833a7414c100e263ac1"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "04d1d17251b84054a0a92ed36338ed06"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "7742deab8a264bbfa7ef5c4f8d1d92c3"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "04a1ba5fdabc4d509e7e80119454647d"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "59fbbaab4c9144b89f08e19bdc818dde"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "499cb266da324049aea8e1f0c84a5d1c"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:38:34+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "WARNING", "logger": "app.security.security", "msg": "JWT invalide (signature/iss/exp)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:38:34+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "26728e0dd18647b38f1e1e8a6288c698"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "26728e0dd18647b38f1e1e8a6288c698"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "26728e0dd18647b38f1e1e8a6288c698"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "f79b27099c214c72ad6a8080bbf7ba9a"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "f79b27099c214c72ad6a8080bbf7ba9a"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "f79b27099c214c72ad6a8080bbf7ba9a"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "c701a84f25274e27ae7d65090febf34f", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0e433101075a4268860a8f67fd58bdb0"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0e433101075a4268860a8f67fd58bdb0"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0e433101075a4268860a8f67fd58bdb0"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "3c863943241a4d97853716ba4fab8870"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "3c863943241a4d97853716ba4fab8870"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "3c863943241a4d97853716ba4fab8870"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "9dbafea44be94f768211fcb0fc4ab10b"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "9dbafea44be94f768211fcb0fc4ab10b"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9dbafea44be94f768211fcb0fc4ab10b"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "1c53a915d9774b0dbf1bee2b7aa7ca79"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "1c53a915d9774b0dbf1bee2b7aa7ca79"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "1c53a915d9774b0dbf1bee2b7aa7ca79"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "447069b675b5499099bf4a6c82a62ee8"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "447069b675b5499099bf4a6c82a62ee8"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "447069b675b5499099bf4a6c82a62ee8"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8449c7967ed246259402eb54a69f4548"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "a0c9b35850054515b3f31fdca2553935"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "2e8068f4fba44e2385a0bfcce4546491"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:58+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/metrics \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/metrics \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "ERROR", "logger": "customer-api", "msg": "RabbitMQ startup failed", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\main.py\", line 56, in lifespan\n    asyncio.create_task(\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\tasks.py\", line 420, in create_task\n    task = loop.create_task(coro)\n           ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\base_events.py\", line 458, in create_task\n    task = tasks.Task(coro, loop=self, name=name, context=context)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: a coroutine was expected, got None"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "9f8604a7c4d74ecd804ff2f3e9f33b28"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "d7331d78cdd4480196b44229b982703b"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "b33b064de7844043bca7b04a1cb713e5"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:41:59+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "WARNING", "logger": "app.security.security", "msg": "JWT invalide (signature/iss/exp)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:41:59+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "18e5f16eee764af78e8f9171ea7f3ea6"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "18e5f16eee764af78e8f9171ea7f3ea6"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "18e5f16eee764af78e8f9171ea7f3ea6"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "75a23d5e70ef4e43a8fa69a67fc60ee4"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "75a23d5e70ef4e43a8fa69a67fc60ee4"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "75a23d5e70ef4e43a8fa69a67fc60ee4"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "dcc559f6f6d94ba294737b95740dacfe", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "220e164bb1fd401fba70d50b1a8ab7f3"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "220e164bb1fd401fba70d50b1a8ab7f3"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "220e164bb1fd401fba70d50b1a8ab7f3"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "737fbadf852442f1ae8bafce716f8ebd"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "737fbadf852442f1ae8bafce716f8ebd"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "737fbadf852442f1ae8bafce716f8ebd"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "0b7a7488bf9f46acb2649a52f0cbd296"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "0b7a7488bf9f46acb2649a52f0cbd296"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0b7a7488bf9f46acb2649a52f0cbd296"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "bb3ef91348a343f89871f2ad053f37e0"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "bb3ef91348a343f89871f2ad053f37e0"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "bb3ef91348a343f89871f2ad053f37e0"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "05c7f8d07ae342c18c638a6f38d54a46"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "05c7f8d07ae342c18c638a6f38d54a46"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "05c7f8d07ae342c18c638a6f38d54a46"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "103fc3f91a794273a44838b0d3529e2a"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "1916576f0375407980610a316d77f08d"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "d1a3e75e236f476abeeb5c67e65c3bc4"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:50+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "ERROR", "logger": "app.core.database", "msg": "db session rolled back due to exception", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\core\\database.py\", line 54, in get_db\n    yield db\nValueError: fail"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/metrics \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/metrics \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "ERROR", "logger": "customer-api", "msg": "RabbitMQ startup failed", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\main.py\", line 56, in lifespan\n    asyncio.create_task(\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\tasks.py\", line 420, in create_task\n    task = loop.create_task(coro)\n           ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\base_events.py\", line 458, in create_task\n    task = tasks.Task(coro, loop=self, name=name, context=context)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: a coroutine was expected, got None"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2b6c5a4bf3c84704b36b4a299a3ebb75"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "3b809a3336bf4339968186ee029c61f8"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "b73c797c90d6448c94672c010b1dde6d"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:44:51+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "WARNING", "logger": "app.security.security", "msg": "JWT invalide (signature/iss/exp)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:44:51+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "ee2088c1b3a84c70a534fd3d28afdfcd"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "ee2088c1b3a84c70a534fd3d28afdfcd"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "ee2088c1b3a84c70a534fd3d28afdfcd"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "2ee8e1739da2460d87a7b23e523c2dce"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "2ee8e1739da2460d87a7b23e523c2dce"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "2ee8e1739da2460d87a7b23e523c2dce"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "b111b577455247c5a3779ce230f78b76", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "8312daf189dc493990486ff2e48ade02"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "8312daf189dc493990486ff2e48ade02"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "8312daf189dc493990486ff2e48ade02"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "6f8653ee531b414192e79300ba73df75"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "6f8653ee531b414192e79300ba73df75"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "6f8653ee531b414192e79300ba73df75"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "085f0ee4d4d04961862db098905cfae4"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "085f0ee4d4d04961862db098905cfae4"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "085f0ee4d4d04961862db098905cfae4"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "b847ac80394c4ea1b482102ca27b0d35"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "b847ac80394c4ea1b482102ca27b0d35"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "b847ac80394c4ea1b482102ca27b0d35"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "3e28f7e4b1e14ddf84e4e17954c74a21"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "3e28f7e4b1e14ddf84e4e17954c74a21"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "3e28f7e4b1e14ddf84e4e17954c74a21"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "22ffba55fba544fa8a4c4e47c62f479c"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "b7ab280a3f6c4d3eaa31067d956598e3"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "b32c2303ad214814815048395c89fcd5"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "ERROR", "logger": "app.core.database", "msg": "db session rolled back due to exception", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\core\\database.py\", line 54, in get_db\n    yield db\nValueError: fail"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/metrics \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/metrics \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "ERROR", "logger": "customer-api", "msg": "RabbitMQ startup failed", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\main.py\", line 56, in lifespan\n    asyncio.create_task(\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\tasks.py\", line 420, in create_task\n    task = loop.create_task(coro)\n           ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\base_events.py\", line 458, in create_task\n    task = tasks.Task(coro, loop=self, name=name, context=context)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: a coroutine was expected, got None"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "40c4a5fa2ee84232a1582c56389cfe53"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "28a120e8e67d4fb2816ca87b81fadfeb"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "e846b633c52c481cb7cbe6e57e9e3b09"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:46:33+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "WARNING", "logger": "app.security.security", "msg": "JWT invalide (signature/iss/exp)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:46:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "097306dc1d634e2ca5ea22ca6e2ab4b6"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "097306dc1d634e2ca5ea22ca6e2ab4b6"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "097306dc1d634e2ca5ea22ca6e2ab4b6"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "39b893bda1364a53bf4d27363ef1c17a"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "39b893bda1364a53bf4d27363ef1c17a"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "39b893bda1364a53bf4d27363ef1c17a"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "cfdd4ee40e8f45e1860c3a1827a57170", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Jane Doe', 'jane.doe@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "27b8fff4c76b4a1bb089cf842521804a"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "27b8fff4c76b4a1bb089cf842521804a"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "27b8fff4c76b4a1bb089cf842521804a"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "7692097100654002ad24894bd9a7db6e"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "7692097100654002ad24894bd9a7db6e"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "7692097100654002ad24894bd9a7db6e"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/?company=A%20Corp \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "1102826854af4b189b9036fd4eea38d4"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "1102826854af4b189b9036fd4eea38d4"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "1102826854af4b189b9036fd4eea38d4"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "05c89f6ff870436f96966f5c96352b4e"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "05c89f6ff870436f96966f5c96352b4e"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "05c89f6ff870436f96966f5c96352b4e"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "4d70adbd1e7b418fa77073ca87b20656"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "4d70adbd1e7b418fa77073ca87b20656"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "4d70adbd1e7b418fa77073ca87b20656"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "80aef682fb36430fb778d95a57158360"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "d804ddeb94c3485cb2a6726ca17aeb3f"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "687e3fca043d43dfbfcc163f4fe2fecd"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.core.database", "msg": "DB init: tables ensured", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "ERROR", "logger": "app.core.database", "msg": "db session rolled back due to exception", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\core\\database.py\", line 54, in get_db\n    yield db\nValueError: fail"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.infra.events.handlers", "msg": "[customer-api] Orders_count++ et last_order_date MAJ pour client 1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.infra.events.handlers", "msg": "[customer-api] Orders_count++ et last_order_date MAJ pour client 1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "WARNING", "logger": "app.infra.events.handlers", "msg": "order.created sans customer_id", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "WARNING", "logger": "app.infra.events.handlers", "msg": "[customer-api] client 99 non trouvé pour order.created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.infra.events.handlers", "msg": "[customer-api] Orders_count-- pour client 1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "WARNING", "logger": "app.infra.events.handlers", "msg": "order.deleted sans customer_id", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "WARNING", "logger": "app.infra.events.handlers", "msg": "[customer-api] client 42 non trouvé pour order.deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.infra.events.handlers", "msg": "[customer-api] Orders_count-- pour client 1", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/metrics \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/metrics \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "customer-api", "msg": "database connection OK", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "ERROR", "logger": "customer-api", "msg": "RabbitMQ startup failed", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\main.py\", line 56, in lifespan\n    asyncio.create_task(\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\tasks.py\", line 420, in create_task\n    task = loop.create_task(coro)\n           ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\angi\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\asyncio\\base_events.py\", line 458, in create_task\n    task = tasks.Task(coro, loop=self, name=name, context=context)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: a coroutine was expected, got None"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/health \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer created", "service": "customer-api", "request_id": "0b186427016b4c0a9a9f51786784574c"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 201 Created\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/ \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer updated", "service": "customer-api", "request_id": "b5f42dd653d540d0b615b8a72e9291dd"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "app.api.routes", "msg": "customer deleted", "service": "customer-api", "request_id": "1ca87dc386cb46d5a25e068b05f9520a"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/1 \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/client@test.com \"HTTP/1.1 200 OK\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/99 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 400 Bad Request\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: PUT http://testserver/customers/1 \"HTTP/1.1 409 Conflict\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:32+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: DELETE http://testserver/customers/123 \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: GET http://testserver/customers/email/missing@test.com \"HTTP/1.1 404 Not Found\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "httpx", "msg": "HTTP Request: POST http://testserver/customers/ \"HTTP/1.1 403 Forbidden\"", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client deleted", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlite3.IntegrityError: UNIQUE constraint failed: clients.email\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 2028, in commit\n    trans.commit(_to_root=True)\n  File \"<string>\", line 2, in commit\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1313, in commit\n    self._prepare_impl()\n  File \"<string>\", line 2, in _prepare_impl\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\state_changes.py\", line 139, in _go\n    ret_value = fn(self, *arg, **kw)\n                ^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 1288, in _prepare_impl\n    self.session.flush()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4352, in flush\n    self._flush(objects)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4487, in _flush\n    with util.safe_reraise():\n         ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\session.py\", line 4448, in _flush\n    flush_context.execute()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\orm\\persistence.py\", line 1233, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1418, in execute\n    return meth(\n           ^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\sql\\elements.py\", line 515, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1640, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1846, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1986, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 2355, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\base.py\", line 1967, in _exec_single_context\n    self.dialect.do_execute(\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\.venv\\Lib\\site-packages\\sqlalchemy\\engine\\default.py\", line 941, in do_execute\n    cursor.execute(statement, parameters)\nsqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: clients.email\n[SQL: INSERT INTO clients (name, email, company, phone, last_order_date, version) VALUES (?, ?, ?, ?, ?, ?) RETURNING id, created_at, updated_at, orders_count]\n[parameters: ('Dup', 'dup@test.com', None, None, None, 1)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)"}
{"ts": "2025-09-10T21:48:33+0200", "level": "ERROR", "logger": "app.repositories.client", "msg": "error creating client", "service": "customer-api", "request_id": "-", "exc_info": "Traceback (most recent call last):\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\app\\repositories\\client.py\", line 19, in create_client\n    db.commit()\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <lambda>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\n                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\EPSI\\MSPR 4\\PayeTonKawa\\customer-api\\tests\\unit\\test_repositories.py\", line 69, in <genexpr>\n    monkeypatch.setattr(session, \"commit\", lambda: (_ for _ in ()).throw(SQLAlchemyError(\"boom\")))\nsqlalchemy.exc.SQLAlchemyError: boom"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.repositories.client", "msg": "client created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "WARNING", "logger": "app.security.security", "msg": "JWT invalide (signature/iss/exp)", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer created", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer updated", "service": "customer-api", "request_id": "-"}
{"ts": "2025-09-10T21:48:33+0200", "level": "INFO", "logger": "app.services.client_service", "msg": "customer deleted", "service": "customer-api", "request_id": "-"}
